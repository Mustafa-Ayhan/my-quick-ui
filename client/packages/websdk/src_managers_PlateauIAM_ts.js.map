{"version":3,"file":"src_managers_PlateauIAM_ts.js?ver=3.1.2-4","mappings":"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","sources":["webpack://@stechquick/websdk/../../common/shrimp/interfaces/IPromiseData.ts","webpack://@stechquick/websdk/./src/interfaces/externalInterfaces.ts","webpack://@stechquick/websdk/./src/managers/PlateauIAM.ts"],"sourcesContent":["export interface IPromiseData<T> {\n    promise: Promise<T>;\n    resolver: (value: T | PromiseLike<T>) => void;\n    reject: (reason?: any) => void;\n    startTimer: (timeout: number) => void;\n    isResolved: () => boolean;\n    isRejected: () => boolean;\n    isCompleted: () => boolean;\n}\n\n//some platforms have syncronous resolve problem (ex: IOS JavascriptCore)\ndeclare var doNothing: any;\nlet syncResolved = false as boolean;\nnew Promise<void>(res => res()).then(() => syncResolved = true);\ntypeof(doNothing) != \"undefined\" && doNothing();\nconst syncResolveProblem = syncResolved === true; // platform has sync resolve problem or not\n\ntype ResolveFunc<T> = (value: T | PromiseLike<T>) => void;\n/**\n * @param timeout timeout time in ms, undefined if infinite\n */\nexport function CreatePromiseData<T>(timeout?: number, opt: { fixSyncResolve?: boolean } = {}): IPromiseData<T> {\n    const syncResolveFixer = (cb: ResolveFunc<T>) => syncResolveProblem && opt.fixSyncResolve ? (value: T | PromiseLike<T>) => setTimeout(() => cb(value)) : cb;\n    let resolver: ResolveFunc<T> = <any>undefined, reject: (reason?: any) => void = <any>undefined;\n    let timer: number;\n    const startTimer: IPromiseData<T>[\"startTimer\"] = (timeout: number) => {\n        if (timer) { clearTimeout(timer); }\n        timer = setTimeout(() => { reject(new Error(`The operation has timed out. timeoutValue  : ${timeout}`)); }, timeout) as unknown as number;\n    }\n\n    let resolved = false, rejected = false;\n    const isCompleted = () => resolved || rejected;\n    if (timeout) {\n        startTimer(timeout);\n    }\n\n    return {\n        startTimer,\n        promise: new Promise<T>((res, rej) => {\n            const cb = syncResolveFixer(res);\n            resolver = (value: T | PromiseLike<T>) => { if (isCompleted()) { return; } resolved = true; cb(value); };\n            reject = (reason?: any) => { if (isCompleted()) { return; } rejected = true; rej(reason) };\n        }),\n        resolver,\n        reject,\n        isResolved: () => resolved,\n        isRejected: () => rejected,\n        isCompleted,\n    };\n}\n\nexport function PromiseAllSettled<T>(proms: Array<Promise<T>>) : Promise<T> | undefined {\n    const retProm = CreatePromiseData<T>(); \n    let left = proms.length;\n    proms.forEach(async prom => {\n        try{\n            await prom;\n        }finally{\n            if (--left <= 0){\n                retProm.resolver(prom);\n            } \n        }\n    });\n\n    return retProm.promise;\n}\n\n\n","import { IPlateauUIOptions } from '@stechquick/algae/lib/quick/IPlateauUI';\nimport { KeycloakTokenParsed } from 'keycloak-js';\n\nexport interface IAmToken {\n    idToken: string,\n    refreshToken: string,\n    token: string,\n    info?: KeycloakTokenParsed,\n}\n\nexport interface IGetIAmToken {\n    idToken?: string,\n    refreshToken?: string,\n    token?: string,\n    info?: KeycloakTokenParsed,\n}\n\nexport type IAmPopupMessage =\n    { type: \"setTokens\", tokenInfo: IAmToken } |\n    { type: \"iamReady\" } |\n    { type: \"iamOptions\", options?: IPlateauUIOptions, tokens?: IGetIAmToken, sessionStorageNamePrefix?: string, parentWindow?: Object };\n\nexport function doPostMessage(targetWindow: Window, data: IAmPopupMessage) {\n    targetWindow.postMessage(data, \"*\");\n}","import { IPlateauUIOptions, ISettingsIAM, ISettingsIAMOptions, ISettingsIAMV2 } from '@stechquick/algae/lib/quick/IPlateauUI';\nimport Keycloak, { KeycloakInitOptions, KeycloakLoginOptions } from 'keycloak-js';\n// import { URLSearchParams } from 'url';\nimport { IPlateauIAM } from \"../../../../common/shrimp/interfaces/quick/IPlateauIAM\";\nimport { ScriptRootPathHelper } from '../../../../common/shrimp/helpers/scriptRootPathHelper';\nimport { Logger, LogType } from '../../../../common/shrimp/helpers/logger';\nimport { CreatePromiseData } from '../../../../common/shrimp/interfaces/IPromiseData';\nimport { IAmToken, IAmPopupMessage, doPostMessage } from '../interfaces/externalInterfaces';\n\ntype AuthOptions = {\n    url: string,\n    active: boolean,\n    subdomain?: string | null,\n    realm?: string | null,\n    language?: string | null,\n    isLangFromQS?: boolean,\n    clientId?: string,\n    preserveTokens?: boolean,\n    redirectUri?: string,\n    onLoad?: string,\n    popup?: boolean,\n    sessionStorageNamePrefix?: string,\n}\n\nconst fullUrls = [\"https://\", \"http://\"];\nexport class PlateauIAM implements IPlateauIAM {\n\n    public settingsIAM: ISettingsIAM | undefined\n\n    private refreshTime: number = 6000\n    private updateTime: number = 10\n\n    private initOptions: ISettingsIAMOptions = {\n        url: 'http://identity-provider.dev.rally.softtech/auth/',\n        realm: 'main',\n        clientId: 'ui-web-client',\n        onLoad: 'login-required',\n        pkceMethod: 'S256',\n        identityProvider: '',\n        locale: '',\n    }\n\n    private authOptions: AuthOptions = { url: \"\", active: false };\n\n    //MAIN SECURITY OBJECT\n    public keycloak?: Keycloak.KeycloakInstance;\n    // private keycloak?: Keycloak;\n\n    //PLATEAU SECURITY OBJECT\n    private iamPlateau: undefined | { token: string | undefined, info: object | undefined } = undefined\n    private sessionStorageNamePrefix: string = \"\";\n\n    public setOptions({ iam, iamV2 }: { iam: ISettingsIAM[\"iam\"], iamV2?: ISettingsIAMV2 }) {\n        if (iamV2?.active) {\n            this.configureNewOAuthSettings(iamV2);\n        } else {\n            try {\n                const initOptions = iam?.options;\n                if (!initOptions) { throw new Error(\"iam in settings is missing options\"); }\n                if (initOptions.identityProvider != undefined) {\n                    if (typeof initOptions.identityProvider === 'object') {\n                        var subdomain = ''\n                        var ipUrlSplit = initOptions.url!.split('.')\n                        var order = 2\n                        try {\n                            order = parseInt((<any>initOptions.identityProvider).order)\n                            if (order <= 0) {\n                                order = 2\n                            }\n                        } catch (error) {\n                            order = 2\n                        }\n                        if ((<any>initOptions.identityProvider).type === 'queryString') {\n                            var params = new URLSearchParams(window.location.search)\n                            if (params.get('subdomain') != null) {\n                                subdomain = <any>params.get('subdomain')\n                                // ipUrlSplit[1] = subdomain\n                                ipUrlSplit[order - 1] = subdomain\n                                this.initOptions.subdomain = subdomain\n                            }\n                            if (params.get('realm') != null) {\n                                initOptions.realm! = <any>params.get('realm');\n\n                                if(!initOptions.sessionStorageNamePrefix){\n                                    // cookie setle\n                                    document.cookie = \"queryParamsRealmIAM=\" + initOptions.realm + \";path=/;\";\n                                }\n                            }\n                            else if (!initOptions.sessionStorageNamePrefix) {\n                                let queryParamsRealmIAM = this.getItemFromCookies(\"queryParamsRealmIAM\");\n                                if (queryParamsRealmIAM) {\n                                    initOptions.realm! = queryParamsRealmIAM;\n                                }\n                            }\n\n                            const localeKey = initOptions.localeQueryStringKey || \"ui_locales\";\n                            if (params.get(localeKey) != null) {\n                                this.initOptions.locale = <any>params.get(localeKey);\n\n                                if (!initOptions.sessionStorageNamePrefix) {\n                                    document.cookie = \"queryParamsLocaleIAM=\" + this.initOptions.locale + \";path=/;\";\n                                }\n                            }\n                            else {\n                                this.initOptions.locale = undefined;\n\n                                if (!initOptions.sessionStorageNamePrefix) {\n                                    let queryParamsLocaleIAM = this.getItemFromCookies(\"queryParamsLocaleIAM\");\n                                    if (queryParamsLocaleIAM) {\n                                        this.initOptions.locale = queryParamsLocaleIAM;\n                                    }\n                                }\n                            }\n                        } else if ((<any>initOptions.identityProvider).type === 'subdomain') {\n                            var urlSplit = window.location.host.split('.')\n                            subdomain = urlSplit[0]     // optional parametre ile subdomain of subdomain alinabilir\n                            ipUrlSplit[order - 1] = subdomain\n                        }\n                        // ipUrlSplit[1] = subdomain               \n                        initOptions.url! = ipUrlSplit.join('.')\n                    } else if (initOptions.identityProvider.length > 1) {\n                        initOptions.url! = window.location.protocol + '//' + window.location.host.replace(initOptions.identityProvider, 'identity-provider') + '/auth'\n                    }\n                }\n\n                /*         \n                        turisui\n                        http://turisui.participant-turis-mr-484-dev.turispsql.plateaux.softtech\n                        http://identity-provider.participant-turis-mr-484-dev.turispsql.plateaux.softtech/auth\n                 */\n\n\n                if (initOptions.url) this.initOptions.url = initOptions.url;\n                if (initOptions.realm) this.initOptions.realm = initOptions.realm;\n                if (initOptions.clientId) this.initOptions.clientId = initOptions.clientId;\n                if (initOptions.onLoad) this.initOptions.onLoad = initOptions.onLoad;\n                if (initOptions.pkceMethod) this.initOptions.pkceMethod = initOptions.pkceMethod;\n                if (initOptions.identityProvider) this.initOptions.identityProvider = initOptions.identityProvider;\n                if (initOptions.redirectUri) this.initOptions.redirectUri = initOptions.redirectUri;\n                if (initOptions.responseMode) this.initOptions.responseMode = initOptions.responseMode;\n                if (initOptions.preserveTokens) this.initOptions.preserveTokens = initOptions.preserveTokens;\n            } catch (error) {\n                const errMsg = (error as Error).message || \"error has no message\";\n                Logger.Log({ logMessage: \"Error on setting IAM options: \" + errMsg, logType: LogType.Error });\n            }\n        }\n    }\n\n    private getItemFromCookies(key: string) {\n        var i, x, y, ARRcookies = document.cookie.split(\";\");\n        for (i = 0; i < ARRcookies.length; i++) {\n            x = ARRcookies[i].substr(0, ARRcookies[i].indexOf(\"=\"));\n            y = ARRcookies[i].substr(ARRcookies[i].indexOf(\"=\") + 1);\n            x = x.replace(/^\\s+|\\s+$/g, \"\");\n            if (x == key) {\n                return unescape(y);\n            }\n        }\n        return undefined;\n    }\n\n    private configureNewOAuthSettings(iamV2: ISettingsIAMV2) {\n        this.authOptions.active = iamV2.active;\n        let idendityURL = iamV2.idendityProviderURL || \"\";\n\n        var queryParams = new URLSearchParams(window.location.search);\n\n        this.authOptions.subdomain = this.getSubdomain(iamV2, queryParams);\n\n        idendityURL = this.replaceSubdomain(idendityURL, this.authOptions);\n\n        this.authOptions.realm = this.getRealm(iamV2, queryParams);\n\n        this.authOptions.language = this.getLocale(iamV2, queryParams);\n        this.authOptions.url = idendityURL;\n        this.authOptions.clientId = iamV2.clientId;\n        this.authOptions.preserveTokens = iamV2.preserveTokens;\n        this.authOptions.redirectUri = iamV2.redirectUri;\n        this.authOptions.onLoad = iamV2.onLoad;\n\n        this.authOptions.popup = iamV2.popup;\n        this.authOptions.sessionStorageNamePrefix = iamV2.sessionStorageNamePrefix;\n    }\n\n    private getLocale(iamV2: ISettingsIAMV2, queryParams: URLSearchParams): string | null | undefined {\n        return iamV2.isLangFromQS ? queryParams.get(\"lang\") : iamV2.language;\n    }\n\n    private replaceSubdomain(idendityURL: string, authOptions: AuthOptions) {\n        const splittedURL = idendityURL.split(\".\");\n        splittedURL[1] = authOptions.subdomain || splittedURL[1];\n        return splittedURL.join(\".\");\n    }\n\n    private getRealm(iamV2: ISettingsIAMV2, queryParams: URLSearchParams): string | null | undefined {\n        return iamV2.isRealmFromQS ? queryParams.get(\"realm\") : iamV2.realm;\n    }\n\n    private getSubdomain(iamV2: ISettingsIAMV2, queryParams: URLSearchParams) {\n        let domainValue: string | undefined | null = \"\"\n        switch (iamV2.subdomainSource) {\n            case \"constant\":\n                domainValue = iamV2.subdomainValue;\n                break;\n            case \"query\":\n                domainValue = queryParams.get(\"subdomain\");\n                break;\n            case \"currentDomain\":\n                domainValue = window.location.host.split('.')[0];\n                break;\n            default:\n                break;\n        }\n        return domainValue;\n    }\n\n    public isAuthenticated() {\n        if (this.iamPlateau?.token != undefined) return true\n    }\n    public async init(callback: Function, PlateauUIOptions?: IPlateauUIOptions) {\n        const oAuthoptions = this.authOptions.active ? this.authOptions : this.initOptions;\n        this.sessionStorageNamePrefix = (this.settingsIAM?.iam?.options?.sessionStorageNamePrefix || this.authOptions.sessionStorageNamePrefix) ? `${this.settingsIAM?.iam?.options?.sessionStorageNamePrefix || this.authOptions.sessionStorageNamePrefix}_` : \"\";\n        this.keycloak = Keycloak(<any>oAuthoptions);\n        const tokens = this.getTokens();\n        let initOptions = this.getKeyCloakOptions();\n        let loginOptions: KeycloakLoginOptions = this.getLoginOptions();\n\n        if (tokens && tokens.idToken && tokens.refreshToken && tokens.token) {\n            initOptions.idToken = tokens.idToken;\n            initOptions.refreshToken = tokens.refreshToken;\n            initOptions.token = tokens.token;\n        }\n\n        const redirectUri = this.authOptions.active ? this.authOptions.redirectUri : this.initOptions.redirectUri\n        let finalRedirectUri = this.setQueryOrFragment(new URL(window.location.href), redirectUri);\n        if (finalRedirectUri) {\n            loginOptions.redirectUri = finalRedirectUri;\n            initOptions.redirectUri = finalRedirectUri;\n        }\n\n        let auth: boolean = false;\n        const checkIAMPopup = (PlateauUIOptions?.iamWithPopup ?? (this.settingsIAM?.iam?.popup || this.authOptions.popup)) && !PlateauUIOptions?.iamInPopup;\n\n        if (checkIAMPopup) {\n            auth = await this.handleIAMPopup(PlateauUIOptions, initOptions, this.keycloak);\n        } else {\n            auth = await this.keycloak.init(initOptions);\n            if (!auth) {\n                await this.keycloak.login(loginOptions)\n                return;\n            }\n        }\n\n        if (PlateauUIOptions?.iamInPopup) {\n            this.handleInPopup();\n            return;\n        }\n\n        this.setTokens();\n\n        if (typeof auth == 'boolean') {\n            if (!auth) {\n                window.location.reload();\n            } else {\n                this.constructIAMPlateau();\n            }\n            callback()\n        }\n    }\n    private async handleIAMPopup(PlateauUIOptions: IPlateauUIOptions | undefined, initOptions: KeycloakInitOptions, keycloak: Keycloak): Promise<boolean> {\n        let checkPopupClosed: ReturnType<typeof setTimeout>;\n        const tokenProm = CreatePromiseData<IAmToken>();\n\n        const getStaticPrimitiveAttributes = (obj) => {\n            const primitives = {};\n            for (const key in obj) {\n                if (obj.hasOwnProperty(key)) {\n                    const value = obj[key];\n                    if (typeof value === 'string' || typeof value === 'number' || typeof value === 'boolean' || value === null) {\n                        primitives[key] = value;\n                    }\n                }\n            }\n            return primitives;\n        };\n\n        const listener = async (msg: MessageEvent<IAmPopupMessage>) => {\n            if (msg.source != newWindow) { return; }\n\n            switch (msg.data.type) {\n                case \"setTokens\":\n                    window.removeEventListener(\"message\", listener);\n                    msg.data.type =='setTokens' && tokenProm.resolver(msg.data.tokenInfo);\n                    clearInterval(checkPopupClosed);\n                    return;\n                case \"iamReady\":\n                    const parentWindowAttributes = getStaticPrimitiveAttributes(window);\n                    doPostMessage(newWindow!, { type: \"iamOptions\", options: PlateauUIOptions, tokens: this.getTokens(), sessionStorageNamePrefix: this.sessionStorageNamePrefix, parentWindow: parentWindowAttributes });\n                    return;\n            }\n        };\n\n        window.addEventListener(\"message\", listener);\n        const newWindow = window.open(ScriptRootPathHelper.concatUrl(ScriptRootPathHelper.getScriptRoot(), '../assets/oidc.html'), \"plateauIAMPopup\", \"popup\");\n        if (!newWindow) { const message = 'Failed to open new window.'; console.error(message); throw message; }\n\n        checkPopupClosed = setInterval(() => {\n            if (newWindow.closed) {\n                clearInterval(checkPopupClosed);\n                const msg = \"popup window closed before authentication\";\n                console.error(msg);\n                tokenProm.reject(new Error(msg));\n            }\n        }, 500);\n\n        const tokenInfo = await tokenProm.promise;\n        this.setToOptions(initOptions, tokenInfo);\n        return keycloak.init(initOptions);\n    }\n    private handleInPopup(): void {\n        const tokenInfo = this.getTokenFromKeycloak();\n        if (!tokenInfo) { throw new Error(\"could not retrieve tokenInfo from keycloak\"); }\n        doPostMessage(opener, { type: \"setTokens\", tokenInfo });\n        window.close();\n    }\n    private pathJoin(path1: string, path2: string) {\n        path1 = path1.endsWith(\"/\") ? path1.substring(0, path1.length - 1) : path1;\n        path2 = path2.startsWith(\"/\") ? path2.substring(1) : path2;\n        return path1 + \"/\" + path2;\n    }\n    private setQueryOrFragment(location: URL, redirectUrl: string | undefined) {\n        if (!redirectUrl) { return undefined; }\n\n        const fullUrl = fullUrls.find(fullUrl => redirectUrl.startsWith(fullUrl)) != undefined;\n        if (fullUrl) { return redirectUrl; }\n\n        const url = new URL(\"http://a.com/\" + redirectUrl);\n        const locPath = location.pathname == \"/\" ? \"\" : location.pathname;\n        const urlPath = url.pathname == \"/\" ? \"\" : url.pathname;\n\n        let path = locPath && urlPath ? (urlPath.startsWith(\"//\") ? urlPath.substring(1) : this.pathJoin(locPath, urlPath)) : locPath || urlPath;\n        let search = location.search && url.search ? location.search + url.search.replace(\"?\", \"&\") : location.search || url.search;\n        let hash = location.hash && url.hash ? location.hash + url.hash.replace(\"#\", \"&\") : location.hash || url.hash;\n        return location.origin + path + search + hash;\n    }\n    private constructIAMPlateau() {\n        if (this.iamPlateau == undefined) this.iamPlateau = { token: this.keycloak?.token, info: this.keycloak?.tokenParsed }\n        else this.iamPlateau.token = this.keycloak?.token\n\n\n        // if (window.location.search) sessionStorage.setItem('queryParams', window.location.search);\n        if (window.location.search) document.cookie = \"queryParamsIAM=\" + window.location.search + \";path=/;\"\n    }\n    private getTokens(): { idToken: string | undefined, refreshToken: string | undefined, token: string | undefined } | undefined {\n        if (!this.authOptions.preserveTokens && !this.settingsIAM?.iam?.options?.preserveTokens) return undefined;\n        return {\n            idToken: sessionStorage.getItem(this.sessionStorageNamePrefix + \"kcIdToken\") ?? undefined,\n            refreshToken: sessionStorage.getItem(this.sessionStorageNamePrefix + \"kcRefreshToken\") ?? undefined,\n            token: sessionStorage.getItem(this.sessionStorageNamePrefix + \"kcToken\") ?? undefined\n        };\n    }\n    private getTokenFromKeycloak(): IAmToken | undefined {\n        if (!this.keycloak) return undefined;\n        if (!this.keycloak.idToken || !this.keycloak.refreshToken || !this.keycloak.token) return undefined;\n        return { idToken: this.keycloak.idToken, refreshToken: this.keycloak.refreshToken, token: this.keycloak.token, info: this.keycloak.tokenParsed };\n    }\n    private setToOptions(initOptions: KeycloakInitOptions, tokenInfo: IAmToken) {\n        initOptions.idToken = tokenInfo.idToken;\n        initOptions.refreshToken = tokenInfo.refreshToken;\n        initOptions.token = tokenInfo.token;\n    }\n    private setTokens(options: { tokenInfo?: IAmToken } = {}) {\n        if (!this.authOptions.preserveTokens && !this.settingsIAM?.iam?.options?.preserveTokens) return undefined;\n        const tokenInfo = options.tokenInfo ?? this.getTokenFromKeycloak();\n        if (!tokenInfo) return undefined;\n\n        sessionStorage.setItem(this.sessionStorageNamePrefix + \"kcIdToken\", tokenInfo.idToken);\n        sessionStorage.setItem(this.sessionStorageNamePrefix + \"kcRefreshToken\", tokenInfo.refreshToken);\n        sessionStorage.setItem(this.sessionStorageNamePrefix + \"kcToken\", tokenInfo.token);\n    }\n    public async refreshPromise() {\n        let isRefreshed: boolean | undefined = false;\n        try {\n            isRefreshed = await this.keycloak?.updateToken(this.updateTime);\n            this.constructIAMPlateau();\n            this.setTokens();\n        } catch (err) {\n            window.location.href = window.location.protocol + '//' + window.location.host;\n        }\n        return isRefreshed;\n    }\n\n    private getKeyCloakOptions() {\n        if (this.authOptions.active) {\n            return { onLoad: \"login-required\", pkceMethod: 'S256', checkLoginIframe: false, responseMode: 'fragment' } as KeycloakInitOptions;\n        }\n        return { onLoad: <any>this.initOptions.onLoad!, pkceMethod: <any>this.initOptions.pkceMethod!, checkLoginIframe: false, responseMode: <any>this.initOptions.responseMode } as KeycloakInitOptions;\n    }\n    private getLoginOptions() {\n        return { locale: this.authOptions.language || this.initOptions.locale! };\n    }\n\n\n    public logout() {\n        let getredirectURL = window.location.protocol + '//' + window.location.host\n        let paramsArr = this.getLogoutURLParams();\n        getredirectURL = this.getRedirectURL(paramsArr, getredirectURL);\n        Logger.Log({ logMessage: 'getredirectURL:' })\n        Logger.Log({ logMessage: getredirectURL })\n        // const getredirectURL = this.initOptions.url\n        const options = { redirectUri: getredirectURL }\n        const logoutUrl = this.keycloak?.createLogoutUrl(options)\n        const options2 = { redirectUri: logoutUrl }\n        this.keycloak?.logout(options2)\n    }\n\n    private getRedirectURL(paramsArr: { key: string; value: string | null | undefined; }[], getredirectURL: string) {\n        if (this.authOptions.active || (<any>this.initOptions.identityProvider!).type === 'queryString') {\n            paramsArr.reduce((acc, param, index) => {\n                if (!param.value) { return acc; }\n                const separator = index === 0 ? '?' : '&';\n                return getredirectURL = getredirectURL + separator + `${param.key}=${param.value}`;\n            }, '');\n        }\n        return getredirectURL;\n    }\n\n    private getLogoutURLParams() {\n        const newOptions = this.authOptions.active ? this.authOptions : this.initOptions;\n        const lang = this.authOptions.active ? this.authOptions.language : this.initOptions.locale;\n        return [{ key: \"realm\", value: newOptions.realm }, { key: \"subdomain\", value: newOptions.subdomain }, { key: \"lang\", value: lang }];\n    }\n\n    public getToken = () => {\n        if (this.iamPlateau != undefined)\n            return this.iamPlateau.token\n        else return undefined\n    }\n    public getInfo = () => {\n        if (this.iamPlateau != undefined)\n            return this.iamPlateau.info\n        else return undefined\n    }\n\n    public async login(PlateauUIOptions?: IPlateauUIOptions) {\n        var callback = () => {\n/*             setInterval(() => {\n                this.refresh()\n            }, this.refreshTime)\n */        }\n        await this.init(callback, PlateauUIOptions)\n    }\n}\n\n"],"names":[],"sourceRoot":""}