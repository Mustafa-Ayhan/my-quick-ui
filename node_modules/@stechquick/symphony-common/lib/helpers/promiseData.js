"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CreatePromiseData = void 0;
let syncResolved = false;
new Promise(res => res()).then(() => syncResolved = true);
typeof (doNothing) != "undefined" && doNothing();
const syncResolveProblem = syncResolved === true; // platform has sync resolve problem or not
/**
 * @param timeout timeout time in ms, undefined if infinite
 */
function CreatePromiseData(timeout, opt = {}) {
    const syncResolveFixer = (cb) => syncResolveProblem && opt.fixSyncResolve ? (value) => setTimeout(() => cb(value)) : cb;
    let resolver = undefined, reject = undefined;
    let timer;
    const startTimer = (timeout) => {
        if (timer) {
            clearTimeout(timer);
        }
        timer = setTimeout(() => { reject(new Error(`The operation has timed out. timeoutValue  : ${timeout}`)); }, timeout);
    };
    if (timeout) {
        startTimer(timeout);
    }
    return {
        startTimer,
        promise: new Promise((res, rej) => { resolver = syncResolveFixer(res); reject = rej; }),
        resolver,
        reject
    };
}
exports.CreatePromiseData = CreatePromiseData;
//# sourceMappingURL=promiseData.js.map