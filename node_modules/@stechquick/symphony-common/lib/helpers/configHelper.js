"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConfigHelper = void 0;
const evalHelper_1 = require("@stechquick/algae/lib/helpers/evalHelper");
class ConfigHelper {
    static resolveConfigObject(object) {
        return Object.keys(object).reduce((prev, key) => {
            let value = object[key];
            switch (typeof value) {
                case "object":
                    prev[key] = value === null ? null : ConfigHelper.resolveConfigObject(value);
                    break;
                case "string":
                    prev[key] = this.resolveValue(value);
                    break;
                default:
                    prev[key] = value;
                    break;
            }
            return prev;
        }, {});
    }
    static resolveValue(value) {
        const res = this.evalHelper.evalLiteral(value);
        if (res.evaluated) {
            return res.retVal;
        }
        const startString = "${";
        if (value.startsWith("\\" + startString)) {
            return value.substring(1);
        } //escaped \${...}
        if (!value.startsWith(startString)) {
            return value;
        } //normal string
        let searchStart = startString.length;
        let endString = value.split("}")[1];
        while (true) {
            const candidate = value.indexOf("}", searchStart);
            if (candidate == -1) {
                return value;
            } //malformed ${...
            if (value[candidate - 1] == "\\") {
                searchStart = candidate + 1;
                continue;
            } //inner escaped ${..\}..}
            const envKey = value.substring(startString.length, candidate); //real env lookup key ${...}
            return process.env[envKey] + endString;
        }
    }
}
exports.ConfigHelper = ConfigHelper;
ConfigHelper.evalHelper = new evalHelper_1.EvalHelper();
//# sourceMappingURL=configHelper.js.map