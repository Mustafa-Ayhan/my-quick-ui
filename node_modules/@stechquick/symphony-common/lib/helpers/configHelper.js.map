{"version":3,"file":"configHelper.js","sourceRoot":"","sources":["../../src/helpers/configHelper.ts"],"names":[],"mappings":";;;AAAA,yEAAsE;AACtE,MAAa,YAAY;IACd,MAAM,CAAC,mBAAmB,CAAC,MAA2B;QACzD,OAAO,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,MAAM,CAAsB,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE;YACjE,IAAI,KAAK,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;YACxB,QAAQ,OAAO,KAAK,EAAE;gBAClB,KAAK,QAAQ;oBAAE,IAAI,CAAC,GAAG,CAAC,GAAG,KAAK,KAAK,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,YAAY,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;oBAAC,MAAM;gBAClG,KAAK,QAAQ;oBAAE,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;oBAAC,MAAM;gBAC3D;oBAAS,IAAI,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;oBAAC,MAAM;aACrC;YACD,OAAO,IAAI,CAAC;QAChB,CAAC,EAAE,EAAE,CAAC,CAAC;IACX,CAAC;IAGO,MAAM,CAAC,YAAY,CAAC,KAAa;QACrC,MAAM,GAAG,GAAG,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QAC/C,IAAI,GAAG,CAAC,SAAS,EAAE;YAAE,OAAO,GAAG,CAAC,MAAM,CAAC;SAAE;QAEzC,MAAM,WAAW,GAAG,IAAI,CAAC;QACzB,IAAI,KAAK,CAAC,UAAU,CAAC,IAAI,GAAG,WAAW,CAAC,EAAE;YACtC,OAAO,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;SAC7B,CAAC,iBAAiB;QACnB,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,WAAW,CAAC,EAAE;YAChC,OAAO,KAAK,CAAC;SAChB,CAAC,eAAe;QACjB,IAAI,WAAW,GAAG,WAAW,CAAC,MAAM,CAAC;QACrC,IAAI,SAAS,GAAG,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QAEpC,OAAO,IAAI,EAAE;YACT,MAAM,SAAS,GAAG,KAAK,CAAC,OAAO,CAAC,GAAG,EAAE,WAAW,CAAC,CAAC;YAClD,IAAI,SAAS,IAAI,CAAC,CAAC,EAAE;gBAAE,OAAO,KAAK,CAAC;aAAE,CAAC,iBAAiB;YAExD,IAAI,KAAK,CAAC,SAAS,GAAG,CAAC,CAAC,IAAI,IAAI,EAAE;gBAAE,WAAW,GAAG,SAAS,GAAG,CAAC,CAAC;gBAAC,SAAS;aAAE,CAAC,yBAAyB;YAEtG,MAAM,MAAM,GAAG,KAAK,CAAC,SAAS,CAAC,WAAW,CAAC,MAAM,EAAE,SAAS,CAAC,CAAC,CAAC,4BAA4B;YAC3F,OAAO,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,SAAS,CAAC;SAC1C;IACL,CAAC;;AArCL,oCAsCC;AAzBkB,uBAAU,GAAG,IAAI,uBAAU,EAAE,CAAC","sourcesContent":["import { EvalHelper } from \"@stechquick/algae/lib/helpers/evalHelper\";\nexport class ConfigHelper {\n    public static resolveConfigObject(object: Record<string, any>) {\n        return Object.keys(object).reduce<Record<string, any>>((prev, key) => {\n            let value = object[key];\n            switch (typeof value) {\n                case \"object\": prev[key] = value === null ? null : ConfigHelper.resolveConfigObject(value); break;\n                case \"string\": prev[key] = this.resolveValue(value); break;\n                default: prev[key] = value; break;\n            }\n            return prev;\n        }, {});\n    }\n\n    private static evalHelper = new EvalHelper();\n    private static resolveValue(value: string) {\n        const res = this.evalHelper.evalLiteral(value);\n        if (res.evaluated) { return res.retVal; }\n\n        const startString = \"${\";\n        if (value.startsWith(\"\\\\\" + startString)) {\n            return value.substring(1);\n        } //escaped \\${...}\n        if (!value.startsWith(startString)) {\n            return value;\n        } //normal string\n        let searchStart = startString.length;\n        let endString = value.split(\"}\")[1];\n\n        while (true) {\n            const candidate = value.indexOf(\"}\", searchStart);\n            if (candidate == -1) { return value; } //malformed ${...\n\n            if (value[candidate - 1] == \"\\\\\") { searchStart = candidate + 1; continue; } //inner escaped ${..\\}..}\n\n            const envKey = value.substring(startString.length, candidate); //real env lookup key ${...}\n            return process.env[envKey] + endString;\n        }\n    }\n}"]}