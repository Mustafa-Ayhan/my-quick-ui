{"version":3,"file":"corsHelper.js","sourceRoot":"","sources":["../../src/helpers/corsHelper.ts"],"names":[],"mappings":";;;AAcA,MAAa,WAAW;IAEpB;;;OAGG;IACI,MAAM,CAAC,UAAU,CAAC,IAAsD,EAAE,iBAA8B;QAE3G,MAAM,EACF,YAAY,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,EAC5B,MAAM,EACN,YAAY,GAAG,CAAC,aAAa,EAAE,cAAc,EAAE,QAAQ,EAAE,YAAY,CAAC,EACtE,YAAY,GAAG,CAAC,MAAM,EAAE,KAAK,EAAE,SAAS,CAAC,EAC5C,GAAG,iBAAiB,CAAC;QAEtB,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;YACd,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,CAAC;SACjD;QAED,IAAI,YAAY,IAAI,YAAY,CAAC,GAAG,CAAC,KAAK,IAAI,IAAI,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,IAAI,EAAE;YACrF,OAAO,CAAC,GAAG,CAAC,gCAAgC,CAAC,CAAC;YAC9C,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,UAAU,EAAE,GAAG,EAAE,OAAO,EAAE,WAAW,EAAE,CAAC;SACpE;QAED,OAAO,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;QACnC,MAAM,OAAO,GAA2C,EAAE,CAAC;QAC3D,OAAO,CAAC,6BAA6B,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,GAAG,CAAC;QAC/D,OAAO,CAAC,kCAAkC,CAAC,GAAG,MAAM,CAAC;QAErD,IAAI,IAAI,CAAC,MAAM,IAAI,SAAS,EAAE;YAC1B,OAAO,CAAC,GAAG,CAAC,6BAA6B,CAAC,CAAC;YAC3C,OAAO,CAAC,8BAA8B,CAAC,GAAG,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACjE,OAAO,CAAC,8BAA8B,CAAC,GAAG,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACjE,IAAI,MAAM,EAAE;gBACR,OAAO,CAAC,wBAAwB,CAAC,GAAG,MAAM,CAAC;aAC9C;YACD,OAAO,CAAC,MAAM,CAAC,GAAG,yBAAyB,CAAC;YAC5C,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,aAAa,EAAE,KAAK,EAAE,OAAO,EAAE,CAAC;SAC3D;QACD,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;IAE3D,CAAC;CACJ;AA1CD,kCA0CC","sourcesContent":["import { HttpMethods } from \"../interfaces/NetworkInterfaces/httpMethods\";\n\nexport interface IManageCors {\n    /**\n     * allowed CORS origins\n     * * \\* to allow all\n     * @example {allowOrigins: {\"http://my.own.domain.com\": true}}\n     */\n    allowOrigins?: Record<string, boolean>;\n    maxAge?: string;\n    allowHeaders?: Array<string>;\n    allowMethods?: Array<string>;\n}\n\nexport class CorsManager {\n\n    /**\n     * \n     * @returns {keepExecution: this is not}\n     */\n    public static ManageCors(data: { origin?: Array<string>, method?: HttpMethods }, manageCorsOptions: IManageCors): { statusCode: number, message: string, success: false } | { success: true, keepExecution: boolean, headers?: Record<string, string | Array<string>> } {\n\n        const {\n            allowOrigins = { \"*\": true },\n            maxAge,\n            allowHeaders = [\"X-PINGOTHER\", \"Content-Type\", \"Cookie\", \"Set-Cookie\"],\n            allowMethods = [\"POST\", \"GET\", \"OPTIONS\"]\n        } = manageCorsOptions;\n\n        if (!data.origin) {\n            return { success: true, keepExecution: true };\n        }\n\n        if (allowOrigins && allowOrigins[\"*\"] !== true && allowOrigins[data.origin[0]] !== true) {\n            console.log(\"Http header Origin Not allowed\");\n            return { success: false, statusCode: 403, message: \"Forbidden\" };\n        }\n\n        console.log(\"adding CORS headers\");\n        const headers: Record<string, string | Array<string>> = {};\n        headers[\"Access-Control-Allow-Origin\"] = data.origin[0] || \"*\";\n        headers[\"Access-Control-Allow-Credentials\"] = \"true\";\n\n        if (data.method == \"OPTIONS\") {\n            console.log(\"adding CORS OPTIONS headers\");\n            headers[\"Access-Control-Allow-Methods\"] = allowMethods.join(\",\");\n            headers[\"Access-Control-Allow-Headers\"] = allowHeaders.join(\",\");\n            if (maxAge) {\n                headers[\"Access-Control-Max-Age\"] = maxAge;\n            }\n            headers[\"Vary\"] = \"Accept-Encoding, Origin\";\n            return { success: true, keepExecution: false, headers };\n        }\n        return { success: true, keepExecution: true, headers };\n\n    }\n}"]}