{"version":3,"file":"versionHelper.js","sourceRoot":"","sources":["../../src/executables/versionHelper.ts"],"names":[],"mappings":"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","sourcesContent":["import fs from \"fs\";\nimport { exists } from \"../helpers/fileHelper\"\n\ninterface IPackageJson { version: string, name: string, dependencies: Record<string,string> , devDependencies: Record<string, string> };\n\nconst extractTypes = {\n    pure: (packageJson: IPackageJson) => `\nconst obj = {name: \"${packageJson.name}\", version: \"${packageJson.version}\", date: \"${new Date()}\"};\nexport default obj;`,\n    pureMono: (projectPackageJson: IPackageJson, monoRepoPackageJson?: IPackageJson) => {\n        const file =`\nconst projectVersions = { name: \"${projectPackageJson.name}\", version: \"${projectPackageJson.version}\", date: \"${new Date()}\", dependencies: ${JSON.stringify(projectPackageJson.dependencies)}, devDependencies: ${JSON.stringify(projectPackageJson.devDependencies)} };\nconst monoRepoVersions = { name: \"${monoRepoPackageJson?.name}\", version: \"${monoRepoPackageJson?.version}\", date: \"${new Date()}\", dependencies: ${JSON.stringify(monoRepoPackageJson?.dependencies)}, devDependencies: ${JSON.stringify(monoRepoPackageJson?.devDependencies)} };\nexport default { projectVersions, monoRepoVersions };`;\n        return file;\n    },\n    window: (projectPackageJson: IPackageJson, monoRepoPackageJson?: IPackageJson) => `\nconst win: {quickVersions?: Record<string, {version?: string, date?: string} | undefined> } = <any>window;\nwin.quickVersions = win.quickVersions || {};\nwin.quickVersions[\"${projectPackageJson.name}\"] = win.quickVersions[\"${projectPackageJson.name}\"] || {};\nwin.quickVersions[\"${projectPackageJson.name}\"].version = \"${projectPackageJson.version}\";\nwin.quickVersions[\"${projectPackageJson.name}\"].date = \"${new Date()}\";\nexport {};\n    `,\n    json: (projectPackageJson: IPackageJson, monoRepoPackageJson?: IPackageJson) => `{\"name\": \"${projectPackageJson.name}\", \"version\": \"${projectPackageJson.version}\", \"date\": \"${new Date()}\"}`\n};\n\ntype extractFuncType = (projectPackageJson: IPackageJson, monoRepoPackageJson?: IPackageJson) => string;\nconst extractTypeDict: Record<string, extractFuncType | undefined> = extractTypes;\n\nasync function extractVersion(extractionPath: string, extractFunc: extractFuncType) {\n    const projectFile = fs.readFileSync(\"./package.json\", \"utf-8\");\n    const packageJson: IPackageJson = JSON.parse(projectFile);\n\n    let monoRepoJson: IPackageJson | undefined = undefined;\n    const monoRepoFilePath = \"./../package.json\";\n    if (await exists(monoRepoFilePath)) {\n        const projectFile = fs.readFileSync(monoRepoFilePath, \"utf-8\");\n        monoRepoJson = JSON.parse(projectFile);\n    }\n\n    const content = extractFunc(packageJson, monoRepoJson);\n    fs.writeFileSync(extractionPath, content, \"utf-8\");\n    console.log(`Version file generated: ${packageJson.name}. At Path: ${extractionPath}`);\n};\n\nfunction execute() {\n    const extractionPath = process.argv[2];\n    if (!extractionPath) {\n        console.error(\"no extractionPath specified. Usage: node ./node_modules/quick-shrimp/lib/executables/versionHelper.js {extractionPath}\");\n        return;\n    }\n    const extractType = extractTypeDict[process.argv[3]] || extractTypes.window;\n    extractVersion(extractionPath, extractType);\n}\n\nexecute();"]}