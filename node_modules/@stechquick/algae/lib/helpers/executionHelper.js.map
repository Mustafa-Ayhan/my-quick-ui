{"version":3,"file":"executionHelper.js","sourceRoot":"","sources":["../../src/helpers/executionHelper.ts"],"names":[],"mappings":";AAAA;;;;;;;;GAQG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiCH;IAEI,gBACqB,GAAW,EACX,OAAuB;QADvB,QAAG,GAAH,GAAG,CAAQ;QACX,YAAO,GAAP,OAAO,CAAgB;QAHpC,UAAK,GAAuB,EAAE,CAAC;IAInC,CAAC;IAEL,sBAAW,6BAAS;aAApB;YACI,IAAM,IAAI,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;YAC5B,IAAI,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;gBAAE,OAAO,KAAK,CAAC;aAAE;YAC7C,OAAO,IAAI,CAAC;QAChB,CAAC;;;OAAA;IAEO,yBAAQ,GAAhB,cAAqB,OAAO,IAAI,CAAC,KAAK,CAAC,CAAC,CAAwC,CAAC,CAAC,CAAC;IAC3E,wBAAO,GAAf,cAAoB,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAwC,CAAC,CAAC,CAAC;IACzF,sBAAK,GAAlB,UAAgC,EAA8B;;;;;;wBAC1D,IAAI,CAAC,KAAK,EAAE,CAAC;;;;wBACQ,qBAAM,EAAE,EAAE,EAAA;;wBAAnB,MAAM,GAAG,SAAU;wBAAE,IAAI,CAAC,GAAG,EAAE,CAAC;wBAAC,sBAAO,MAAM,EAAC;;;wBAC3C,IAAI,CAAC,GAAG,CAAC,EAAE,KAAK,SAAA,EAAE,CAAC,CAAC;wBAAC,MAAM,OAAK,CAAC;;;;;KACpD;IACM,sBAAK,GAAZ;QACI,IAAM,IAAI,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;QAC5B,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,OAAO,EAAE;YAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE,EAAE,YAAY,EAAE,CAAC,EAAE,CAAC,CAAC;YAAC,OAAO;SAAE;QACnG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,kBAAkB,EAAE;YAAE,MAAM,IAAI,KAAK,CAAC,sBAAoB,IAAI,CAAC,GAAK,CAAC,CAAC;SAAE;QAC1F,IAAI,CAAC,YAAY,EAAE,CAAC;IACxB,CAAC;IACM,oBAAG,GAAV,UAAW,OAA6B;QACpC,IAAM,IAAI,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;QAC5B,IAAI,CAAC,IAAI,EAAE;YAAE,MAAM,IAAI,KAAK,CAAC,sBAAoB,IAAI,CAAC,GAAK,CAAC,CAAC;SAAE;QAC/D,EAAE,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;QACxD,IAAI,IAAI,CAAC,YAAY,GAAG,CAAC,EAAE;YAAE,MAAM,IAAI,KAAK,CAAC,oBAAkB,IAAI,CAAC,GAAG,kBAAa,IAAI,CAAC,YAAc,CAAC,CAAC;SAAE;QAC3G,CAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,KAAK,KAAI,CAAC,IAAI,CAAC,KAAK,GAAG,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,KAAK,CAAC,CAAC;IACpD,CAAC;IACM,uBAAM,GAAb;QACI,IAAM,IAAI,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;QAC5B,IAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;QAC9B,OAAO;YACH,GAAG,EAAE,IAAI,CAAC,GAAG;YACb,SAAS,EAAE,CAAA,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,SAAS,KAAI,CAAC,CAAC;YACjC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,UAAC,OAAO,EAAE,GAAG,IAAO,OAAO,OAAO,GAAG,CAAC,GAAG,CAAC,OAAO,IAAI,IAAI,CAAC,GAAG,EAAE,CAAC,GAAG,GAAG,CAAC,SAAS,CAAA,CAAC,CAAC,EAAE,CAAC,CAAC;YAC/G,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,UAAA,IAAI,IAAI,OAAA,IAAI,CAAC,KAAK,EAAV,CAAU,CAAC,IAAI,SAAS;YACzD,QAAQ,EAAE,CAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,OAAO,KAAI,SAAS;SACvC,CAAC;IACN,CAAC;IACL,aAAC;AAAD,CAAC,AA5CD,IA4CC;AAGD;IAWI,mBACoB,GAAW;QAAX,QAAG,GAAH,GAAG,CAAQ;QAPf,cAAS,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QAI/B,YAAO,GAAkB,EAAE,CAAC;QAC5B,gBAAW,GAAkC,EAAE,CAAC;IAGpD,CAAC;IAZe,6BAAmB,GAAvC,UAAqD,GAAW,EAAE,EAAkD;;;;4BACzG,qBAAM,IAAI,SAAS,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,EAAA;4BAAzC,sBAAO,SAAkC,EAAC;;;;KAC7C;IAYO,kCAAc,GAAtB,cAA2B,IAAI,IAAI,CAAC,OAAO,EAAE;QAAE,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;KAAE,CAAC,CAAC;IAEhF,yBAAK,GAAnB,UAAiC,EAAkD;;;;;;wBAC/E,IAAI,CAAC,cAAc,EAAE,CAAC;;;;wBACD,qBAAM,EAAE,CAAC,IAAI,CAAC,EAAA;;wBAAvB,MAAM,GAAG,SAAc;wBAAE,IAAI,CAAC,GAAG,EAAE,CAAC;wBAAC,sBAAO,MAAM,EAAC;;;wBAC/C,IAAI,CAAC,GAAG,CAAC,EAAE,KAAK,SAAA,EAAE,CAAC,CAAC;wBAAC,MAAM,OAAK,CAAC;;;;;KACpD;IACM,uBAAG,GAAV,UAAW,OAA6B;QACpC,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,IAAI,CAAC,KAAK,GAAG,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,KAAK,CAAC;QAC5B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;IAC9B,CAAC;IACY,oCAAgB,GAA7B,UAA2C,OAA2E,EAAE,EAA8B;;;;;;wBAC5I,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,SAAS,EAAE,OAAO,CAAC,SAAS,EAAE,kBAAkB,EAAE,OAAO,CAAC,kBAAkB,EAAE,CAAC,CAAC;;;;wBAC1G,qBAAM,EAAE,EAAE,EAAA;;wBAAnB,MAAM,GAAG,SAAU;wBAAE,MAAM,CAAC,GAAG,EAAE,CAAC;wBAAC,sBAAO,MAAM,EAAC;;;wBAC7C,MAAM,CAAC,GAAG,CAAC,EAAE,KAAK,SAAA,EAAE,CAAC,CAAC;wBAAC,MAAM,OAAK,CAAC;;;;;KACtD;IACD;;;OAGG;IACI,+BAAW,GAAlB,UAAmB,GAAW,EAAE,OAAmH;QACzI,IAAA,KAA6C,OAAO,IAAI,EAAE,EAAxD,kBAAkB,wBAAA,EAAE,kBAAkB,wBAAkB,CAAC;QACjE,IAAM,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,EAAE,kBAAkB,oBAAA,EAAE,kBAAkB,oBAAA,EAAE,CAAC,CAAC;QAClF,CAAC,CAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,SAAS,CAAA,IAAI,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACjD,IAAI,CAAC,CAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,UAAU,CAAA,EAAE;YAAE,MAAM,CAAC,KAAK,EAAE,CAAC;SAAE;QAC7C,OAAO,MAAM,CAAC;IAClB,CAAC;IACO,gCAAY,GAApB,UAAqB,SAAiB,EAAE,EAA0G;YAAxG,kBAAkB,wBAAA,EAAE,kBAAkB,wBAAA;QAC5E,IAAI,CAAC,kBAAkB,EAAE;YAAE,OAAO,IAAI,MAAM,CAAC,SAAS,EAAE,EAAE,kBAAkB,oBAAA,EAAE,CAAC,CAAC;SAAE;QAClF,IAAM,cAAc,GAAG,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;QACvF,IAAM,MAAM,GAAM,SAAS,SAAI,cAAc,CAAC,MAAQ,CAAC;QACvD,IAAM,MAAM,GAAG,IAAI,MAAM,CAAC,MAAM,EAAE,EAAE,kBAAkB,oBAAA,EAAE,CAAC,CAAC;QAC1D,cAAc,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAC5B,OAAO,MAAM,CAAC;IAClB,CAAC;IAEM,0BAAM,GAAb;QACI,IAAI,IAAI,CAAC,SAAS,EAAE;YAAE,OAAO,IAAI,CAAC,SAAS,CAAC;SAAE;QAE9C,IAAM,aAAa,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,MAAM,EAAE,EAAV,CAAU,CAAC,CAAC;QACxD,IAAM,MAAM,GAAqB;YAC7B,GAAG,EAAE,IAAI,CAAC,GAAG;YACb,OAAO,EAAE,IAAI,CAAC,KAAK,IAAI,SAAS;YAChC,KAAK,EAAE,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,GAAG,EAAE,CAAC,GAAG,IAAI,CAAC,SAAS;YACpD,SAAS,EAAE,IAAI,CAAC,SAAS;YACzB,OAAO,EAAE,aAAa;YACtB,QAAQ,EAAE,IAAI,CAAC,OAAO,IAAI,SAAS;SACtC,CAAC;QAEF,OAAO,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC;IAC3D,CAAC;IACL,gBAAC;AAAD,CAAC,AAnED,IAmEC;AAnEY,8BAAS;AAuEtB,IAAM,KAAK,GAAG,UAAC,IAAY,IAAK,OAAA,IAAI,OAAO,CAAC,UAAA,GAAG,IAAI,OAAA,UAAU,CAAC,GAAG,EAAE,IAAI,CAAC,EAArB,CAAqB,CAAC,EAAzC,CAAyC,CAAC;AAC1E,IAAM,KAAK,GAAG;;;YAAc,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;YAAC,qBAAM,KAAK,CAAC,GAAG,CAAC,EAAA;;YAAhB,SAAgB,CAAC;YAAC,sBAAO,YAAY,EAAC;;SAAE,CAAC;AAGtG,SAAe,KAAK;;;;;;oBACV,SAAS,GAAG,IAAI,SAAS,CAAC,OAAO,CAAC,CAAC;;;;oBAErC,qBAAM,UAAU,CAAC,SAAS,CAAC,EAAA;;oBAA3B,SAA2B,CAAC;oBAC5B,qBAAM,YAAY,CAAC,SAAS,CAAC,EAAA;;oBAA7B,SAA6B,CAAC;oBAC9B,SAAS,CAAC,GAAG,EAAE,CAAC;oBAChB,UAAU,CAAC;wBACP,IAAM,GAAG,GAAG,SAAS,CAAC,WAAW,CAAC,IAAI,EAAE,EAAE,kBAAkB,EAAE,IAAI,EAAE,kBAAkB,EAAE,IAAI,EAAE,CAAC,CAAC;wBAChG,GAAG,CAAC,KAAK,EAAE,CAAC;wBAAC,GAAG,CAAC,GAAG,EAAE,CAAC;wBAAC,GAAG,CAAC,GAAG,EAAE,CAAC;wBAClC,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC,CAAC;oBACpC,CAAC,CAAC,CAAC;;;;oBAEH,SAAS,CAAC,GAAG,CAAC,EAAE,KAAK,EAAE,IAAE,EAAE,CAAC,CAAC;;;;;;CAGpC;AACD,SAAe,KAAK;;;;;wBAChB,qBAAM,SAAS,CAAC,mBAAmB,CAAC,OAAO,EAAE,UAAO,SAAS;;;wCACzD,qBAAM,YAAY,CAAC,SAAS,CAAC,EAAA;;oCAA7B,SAA6B,CAAC;;;;yBACjC,CAAC,EAAA;;oBAFF,SAEE,CAAC;;;;;CACN;AAED,SAAe,UAAU,CAAC,SAAoB;;;;;;oBACpC,IAAI,GAAG,SAAS,CAAC,WAAW,CAAC,IAAI,EAAE,EAAE,kBAAkB,EAAE,IAAI,EAAE,kBAAkB,EAAE,IAAI,EAAE,UAAU,EAAE,IAAI,EAAE,CAAC,CAAC;oBACnH,IAAI,CAAC,KAAK,EAAE,CAAC;oBAAC,qBAAM,KAAK,CAAC,EAAE,CAAC,EAAA;;oBAAf,SAAe,CAAC;oBAAC,IAAI,CAAC,GAAG,EAAE,CAAC;oBAC1C,IAAI,CAAC,KAAK,EAAE,CAAC;oBAAC,qBAAM,KAAK,CAAC,EAAE,CAAC,EAAA;;oBAAf,SAAe,CAAC;oBAAC,IAAI,CAAC,KAAK,EAAE,CAAC;oBAAC,qBAAM,KAAK,CAAC,EAAE,CAAC,EAAA;;oBAAf,SAAe,CAAC;oBAC7D,IAAI,CAAC,GAAG,EAAE,CAAC;oBAAC,qBAAM,KAAK,CAAC,EAAE,CAAC,EAAA;;oBAAf,SAAe,CAAC;oBAAC,IAAI,CAAC,GAAG,EAAE,CAAC;oBACxC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;;;;;CAC9B;AAED,IAAM,YAAY,GAAG,UAAO,SAAoB;;;;;gBACtC,MAAM,GAAG,SAAS,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;gBAC5C,MAAM,CAAC,GAAG,EAAE,CAAC;gBACI,qBAAM,KAAK,EAAE,EAAA;;gBAAxB,QAAQ,GAAG,SAAa;gBAC9B,MAAM,CAAC,KAAK,EAAE,CAAC;gBACf,MAAM,CAAC,GAAG,EAAE,CAAC;gBACG,qBAAM,KAAK,EAAE,EAAA;;gBAAvB,OAAO,GAAG,SAAa;gBACb,qBAAM,SAAS,CAAC,gBAAgB,CAAC,EAAE,GAAG,EAAE,eAAe,EAAE,EAAE,KAAK,CAAC,EAAA;;gBAA3E,OAAO,GAAG,SAAiE;gBACjE,qBAAM,SAAS,CAAC,gBAAgB,CAAC,EAAE,GAAG,EAAE,eAAe,EAAE,EAAE;;;wCAChE,qBAAM,KAAK,EAAE,EAAA;wCAApB,sBAAO,SAAa,EAAC;;;yBACxB,CAAC,EAAA;;gBAFI,OAAO,GAAG,SAEd;gBACF,OAAO,CAAC,GAAG,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;;;;KACjC,CAAC","sourcesContent":["/**\n * Action'ların key üzerinden ayrılması.\n *  Key <TKey> olabilir, Record<string, string> -> obje alanları concat ederek string key elde edilir, adama verirken TKey'den verilir \n * Backend timing'in client performans alanına yazdırılması\n * capture | mock | off from terminal\n * Action'lara cache setting\n * Action'ların pre ve post'u\n * Sym-Lib üzerinden Pipeline'a tüm actionlar için genel pre ve post. Actionlar TKey ile merkezi ayrıştırılabilir.\n */\n\ninterface IReportBase {\n    key: string;\n    success: boolean;\n    /**\n     * total time in ms\n     */\n    total: number;\n    /**\n     * elapsed miliseconds since midnight 1.1.1970 in UTC\n     * @see Date.now\n     */\n    startTime: number;\n    finished: boolean;\n}\ninterface IActionReport extends IReportBase {\n}\ninterface IExecutionReport extends IReportBase {\n    actions: Array<IActionReport>;\n}\n\ninterface IActionOptions {\n    enableParalelStart?: boolean;\n}\ninterface IActionPart { startTime: number; endTime?: number; error?: unknown; startCounter: number; }\nexport interface IAction {\n    isStarted: boolean;\n    scope<TReturnType>(cb: () => Promise<TReturnType>): Promise<TReturnType>;\n    start(): void;\n    end(options?: { error?: unknown }): void;\n    report(): IActionReport;\n}\nclass Action implements IAction {\n    private parts: Array<IActionPart> = [];\n    public constructor(\n        private readonly key: string,\n        private readonly options: IActionOptions,\n    ) { }\n\n    public get isStarted() {\n        const last = this.getLast();\n        if (!last || !last.endTime) { return false; }\n        return true;\n    }\n\n    private getFirst() { return this.parts[0] as Action[\"parts\"][number] | undefined; }\n    private getLast() { return this.parts[this.parts.length - 1] as Action[\"parts\"][number] | undefined; }\n    public async scope<TReturnType>(cb: () => Promise<TReturnType>) {\n        this.start();\n        try { const retVal = await cb(); this.end(); return retVal; }\n        catch (error) { this.end({ error }); throw error; }\n    }\n    public start() {\n        const last = this.getLast();\n        if (!last || last.endTime) { this.parts.push({ startTime: Date.now(), startCounter: 1 }); return; }\n        if (!this.options.enableParalelStart) { throw new Error(`already started: ${this.key}`); }\n        last.startCounter++;\n    }\n    public end(options?: { error?: unknown }) {\n        const last = this.getLast();\n        if (!last) { throw new Error(`not yet started: ${this.key}`); }\n        --last.startCounter == 0 && (last.endTime = Date.now());\n        if (last.startCounter < 0) { throw new Error(`already ended: ${this.key} counter: ${last.startCounter}`); }\n        options?.error && (last.error = options?.error);\n    }\n    public report(): IActionReport {\n        const last = this.getLast();\n        const first = this.getFirst();\n        return {\n            key: this.key,\n            startTime: first?.startTime || -1,\n            total: this.parts.reduce((prevSum, cur) => { return prevSum + (cur.endTime || Date.now()) - cur.startTime }, 0),\n            success: this.parts.find(park => park.error) == undefined,\n            finished: last?.endTime != undefined,\n        };\n    }\n}\n\n\nexport class Execution {\n    public static async startExecutionScope<TReturnType>(key: string, cb: (execution: Execution) => Promise<TReturnType>) {\n        return await new Execution(key).scope(cb);\n    }\n\n    public readonly startTime = Date.now();\n    public endTime?: number;\n    public error?: unknown;\n    public endReport?: IExecutionReport;\n    private actions: Array<Action> = [];\n    private counterDict: Record<string, Array<Action>> = {};\n    public constructor(\n        public readonly key: string,\n    ) { }\n\n    private assertNotEnded() { if (this.endTime) { throw new Error(`execution already ended`); } }\n\n    private async scope<TReturnType>(cb: (execution: Execution) => Promise<TReturnType>) {\n        this.assertNotEnded();\n        try { const retVal = await cb(this); this.end(); return retVal; }\n        catch (error) { this.end({ error }); throw error; }\n    }\n    public end(options?: { error?: unknown }) {\n        this.assertNotEnded();\n        this.error = options?.error;\n        this.endTime = Date.now();\n    }\n    public async startActionScope<TReturnType>(options: { key: string, transient?: boolean, appendCounterToKey?: boolean }, cb: () => Promise<TReturnType>) {\n        const action = this.startAction(options.key, { transient: options.transient, appendCounterToKey: options.appendCounterToKey });\n        try { const retVal = await cb(); action.end(); return retVal; }\n        catch (error) { action.end({ error }); throw error; }\n    }\n    /**\n     * \n     * @param options {transient: action will not be reported, appendCounterToKey: manage an auto incremented counter for key and append it to key, enableParalelStart: enable multiple start calls}\n     */\n    public startAction(key: string, options?: { doNotStart?: boolean, transient?: boolean, appendCounterToKey?: boolean, enableParalelStart?: boolean }) {\n        const { enableParalelStart, appendCounterToKey } = options || {};\n        const action = this.createAction(key, { appendCounterToKey, enableParalelStart });\n        !options?.transient && this.actions.push(action);\n        if (!options?.doNotStart) { action.start(); }\n        return action;\n    }\n    private createAction(actionKey: string, { appendCounterToKey, enableParalelStart }: { appendCounterToKey?: boolean, enableParalelStart?: boolean }) {\n        if (!appendCounterToKey) { return new Action(actionKey, { enableParalelStart }); }\n        const sameKeyActions = this.counterDict[actionKey] = this.counterDict[actionKey] || [];\n        const newKey = `${actionKey}_${sameKeyActions.length}`;\n        const action = new Action(newKey, { enableParalelStart });\n        sameKeyActions.push(action);\n        return action;\n    }\n\n    public report(): IExecutionReport {\n        if (this.endReport) { return this.endReport; }\n\n        const actionsReport = this.actions.map(m => m.report());\n        const report: IExecutionReport = {\n            key: this.key,\n            success: this.error == undefined,\n            total: (this.endTime || Date.now()) - this.startTime,\n            startTime: this.startTime,\n            actions: actionsReport,\n            finished: this.endTime != undefined,\n        };\n\n        return this.endTime ? this.endReport = report : report;\n    }\n}\n\n\n\nconst sleep = (time: number) => new Promise(res => setTimeout(res, time));\nconst stuff = async () => { console.log(\"doing real stuff\"); await sleep(100); return \"real stuff\"; };\n\n\nasync function test1() {\n    const execution = new Execution(\"test1\");\n    try {\n        await actionTest(execution);\n        await doAsyncStuff(execution);\n        execution.end();\n        setTimeout(() => {\n            const act = execution.startAction(\"x1\", { enableParalelStart: true, appendCounterToKey: true });\n            act.start(); act.end(); act.end();\n            console.log(execution.report());\n        });\n    } catch (ex) {\n        execution.end({ error: ex });\n    }\n\n}\nasync function test2() {\n    await Execution.startExecutionScope(\"test2\", async (execution) => {\n        await doAsyncStuff(execution);\n    });\n}\n\nasync function actionTest(execution: Execution) {\n    const act1 = execution.startAction(\"x1\", { appendCounterToKey: true, enableParalelStart: true, doNotStart: true });\n    act1.start(); await sleep(10); act1.end();\n    act1.start(); await sleep(10); act1.start(); await sleep(10);\n    act1.end(); await sleep(10); act1.end();\n    console.log(act1.report());\n}\n\nconst doAsyncStuff = async (execution: Execution) => {\n    const action = execution.startAction(\"pre\");\n    action.end();\n    const result_1 = await stuff();\n    action.start();\n    action.end();\n    const result0 = await stuff();\n    const result1 = await execution.startActionScope({ key: \"doAsyncStuff1\" }, stuff);\n    const result2 = await execution.startActionScope({ key: \"doAsyncStuff2\" }, async () => {\n        return await stuff();\n    });\n    console.log(result1, result2);\n};"]}