{"version":3,"file":"JSLoader.js","sourceRoot":"","sources":["../../../src/helpers/tsCompiler/JSLoader.ts"],"names":[],"mappings":";;;AAIA;IASI,kBAAY,MAAc,EAAE,SAA+B,EAAE,MAAgB,EAAE,QAAgB,EAAE,OAAe,EAAE,YAAgB,EAAE,OAAY;QAA/C,wBAAA,EAAA,eAAe;QAAE,6BAAA,EAAA,gBAAgB;QAAE,wBAAA,EAAA,YAAY;QAC5I,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAC3B,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;QACvB,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;QACjC,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;IAC3B,CAAC;IAEM,yBAAM,GAAb,UAAc,IAAa;QACvB,IAAI,QAAQ,GAAG,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;QACjJ,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IAC1B,CAAC;IAEO,uCAAoB,GAA5B,UAA6B,MAAc,EAAE,SAA+B,EAAE,MAAgB,EAAE,QAAgB,EAAE,OAAgB,EAAE,YAAoB,EAAE,OAAyB;QAC/K,IAAI,SAAS,GAAW,QAAQ,CAAC;QACjC,IAAI,UAA6B,CAAC;QAClC,IAAI,UAAU,GAAY,KAAK,CAAC;QAChC,IAAI,QAAQ,GAAW,GAAG,CAAC;QAC3B,IAAM,SAAS,GAAG,CAAC,CAAC,CAAC,OAAO,MAAM,KAAK,WAAW,IAAI,MAAM,CAAC,QAAQ,CAAC,CAAC;QACvE,IAAM,WAAW,GAAG,SAAS,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,qBAAqB,CAAC;QAErE,IAAI,QAAQ,GAAG;YACX,UAAU,EAAV,UAAW,QAAiB;gBACxB,UAAU,GAAG,QAAQ,CAAC;gBACtB,SAAS,EAAE,CAAC;gBACZ,IAAI,UAAU,IAAI,SAAS,GAAG,CAAC,EAAE;oBAC7B,OAAO;iBACV;gBACD,UAAW,CAAC,aAAc,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;gBACnD,QAAQ,IAAI,CAAC,CAAC;gBACd,UAAU,CAAC,cAAc,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC;YAC7D,CAAC;YACD,YAAY,EAAZ,UAAa,GAAU;gBACnB,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;gBAC1B,IAAI,IAAI,GAAG,GAAG,CAAC,aAAa,IAAI,GAAG,CAAC,UAAU,CAAC;gBAC/C,IAAI,GAAG,CAAC,IAAI,KAAK,MAAM,IAAI,CAAC,WAAW,CAAC,IAAI,CAAO,IAAM,CAAC,UAAU,CAAC,CAAC,EAAE;oBACpE,QAAQ,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC;oBAC7B,IAAI,SAAS,EAAE;wBACX,SAAS,EAAE,CAAC;qBACf;iBACJ;YACL,CAAC;YACD,aAAa,EAAb,UAAc,GAAU;gBACpB,QAAQ,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC;gBAC7B,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;gBAC3B,IAAI,MAAM,EAAE;oBACR,MAAM,CAAC,GAAG,CAAC,CAAC;iBACf;YACL,CAAC;YACD,YAAY;gBACR,UAAU,CAAC,gBAAgB,CAAC,MAAM,EAAE,QAAQ,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;gBAClE,UAAU,CAAC,gBAAgB,CAAC,OAAO,EAAE,QAAQ,CAAC,aAAa,EAAE,KAAK,CAAC,CAAC;YACxE,CAAC;YACD,cAAc,EAAd,UAAe,GAAU;gBACrB,IAAI,IAAI,GAAG,GAAG,CAAC,aAAa,IAAI,GAAG,CAAC,UAAU,CAAC;gBAC/C,IAAK,CAAC,mBAAmB,CAAC,MAAM,EAAE,QAAQ,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;gBAChE,IAAK,CAAC,mBAAmB,CAAC,OAAO,EAAE,QAAQ,CAAC,aAAa,EAAE,KAAK,CAAC,CAAC;YACtE,CAAC;YACD,MAAM,EAAN,UAAO,IAAa;gBAChB,UAAU,GAAG,QAAS,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;gBAC/C,QAAQ,CAAC,YAAY,EAAE,CAAC;gBAExB,UAAU,CAAC,GAAG,GAAG,OAAO,CAAC,CAAC,CAAE,MAAM,GAAI,KAAK,GAAG,YAAY,CAAC,CAAC,CAAC,MAAM,CAAC;gBAAA,CAAC;gBACrE,UAAU,CAAC,IAAI,GAAG,IAAI,IAAI,iBAAiB,CAAC;gBAC5C,QAAQ,CAAC,WAAW,EAAE,CAAC;gBACvB,IAAI,OAAO,CAAC,OAAO,EAAE;oBACjB,UAAU,CAAC,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC;iBACxC;gBACD,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;YAC1C,CAAC;YACD,WAAW,EAAX;gBACI,IAAI,CAAC,OAAO,CAAC,cAAc,EAAE;oBAAE,OAAO;iBAAE;gBACxC,IAAI,KAAK,GAAG,OAAO,CAAC,cAAc,CAAC;gBACnC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,UAAC,IAAI,EAAE,MAAM,IAAQ,IAAY,CAAC,MAAM,CAAC,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,IAAI,CAAC,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC;YACrH,CAAC;SACJ,CAAC;QAEF,OAAO,QAAQ,CAAC;IAEpB,CAAC;IAAA,CAAC;IACN,eAAC;AAAD,CAAC,AA3FD,IA2FC;AA3FY,4BAAQ","sourcesContent":["export interface IJSLoaderOptions {\n    charset?: string;\n    scriptTagProps?: Record<string, any>;\n}\nexport class JSLoader {\n    JSName: string\n    SuccessCB: Function | undefined;\n    FailCB: Function\n    TryCount: number\n    noCache: boolean;\n    cacheVersion: number;\n    options: IJSLoaderOptions;\n\n    constructor(jsName: string, successCb: Function | undefined, failCb: Function, tryCount: number, noCache = false, cacheVersion = 0, options = {}) {\n        this.JSName = jsName;\n        this.SuccessCB = successCb;\n        this.FailCB = failCb;\n        this.TryCount = tryCount;\n        this.noCache = noCache;\n        this.cacheVersion = cacheVersion;\n        this.options = options;\n    }\n\n    public LoadJS(type?: string) {\n        var cbObject = this.createCallBackObject(this.JSName, this.SuccessCB, this.FailCB, this.TryCount, this.noCache, this.cacheVersion, this.options);\n        cbObject.goLoad(type);\n    }\n\n    private createCallBackObject(jsName: string, successCb: Function | undefined, failCb: Function, tryCount: number, noCache: boolean, cacheVersion: number, options: IJSLoaderOptions) {\n        let retryLeft: number = tryCount;\n        let scriptElem: HTMLScriptElement;\n        let isJSLoaded: boolean = false;\n        let interval: number = 100;\n        const isBrowser = !!(typeof window !== 'undefined' && window.document);\n        const readyRegExp = isBrowser ? /^complete$/ : /^(complete|loaded)$/;\n\n        var cbObject = {\n            retryLogic(isLoaded: boolean) {\n                isJSLoaded = isLoaded;\n                retryLeft--;\n                if (isJSLoaded || retryLeft < 1) {\n                    return;\n                }\n                scriptElem!.parentElement!.removeChild(scriptElem);\n                interval *= 3;\n                setTimeout(function () { cbObject.goLoad(); }, interval);\n            },\n            onScriptLoad(evt: Event) {\n                cbObject.retryLogic(true);\n                var node = evt.currentTarget || evt.srcElement;\n                if (evt.type === 'load' || (readyRegExp.test((<any>node!).readyState))) {\n                    cbObject.clearListeners(evt);\n                    if (successCb) {\n                        successCb();\n                    }\n                }\n            },\n            onScriptError(evt: Event) {\n                cbObject.clearListeners(evt);\n                cbObject.retryLogic(false);\n                if (failCb) {\n                    failCb(evt);\n                }\n            },\n            addListeners() {\n                scriptElem.addEventListener('load', cbObject.onScriptLoad, false);\n                scriptElem.addEventListener('error', cbObject.onScriptError, false);\n            },\n            clearListeners(evt: Event) {\n                var node = evt.currentTarget || evt.srcElement;\n                node!.removeEventListener('load', cbObject.onScriptLoad, false);\n                node!.removeEventListener('error', cbObject.onScriptError, false);\n            },\n            goLoad(type?: string) {\n                scriptElem = document!.createElement('script');\n                cbObject.addListeners();\n\n                scriptElem.src = noCache ?  jsName +  \"?v=\" + cacheVersion : jsName;;\n                scriptElem.type = type || \"text/javascript\";\n                cbObject.setTagProps();\n                if (options.charset) {\n                    scriptElem.charset = options.charset;\n                }\n                document.head.appendChild(scriptElem);\n            },\n            setTagProps() {\n                if (!options.scriptTagProps) { return; }\n                var props = options.scriptTagProps;\n                Object.keys(props).reduce((prev, curKey) => { (prev as any)[curKey] = props[curKey]; return prev; }, scriptElem);\n            }\n        };\n\n        return cbObject;\n\n    };\n}"]}