{"version":3,"file":"domSocket.js","sourceRoot":"","sources":["../../../src/helpers/socket/domSocket.ts"],"names":[],"mappings":"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","sourcesContent":["import { ILogItem, LogLevel, LogLevelLookup } from \"../logger\";\nimport { ISocket } from \"./iSocket\";\n\nexport enum ReconnectType {\n    BackOff,\n    Urgent,\n}\nexport enum ConnectReason {\n    ConnectCall,\n    SendReconnect,\n    ErrorReconnect,\n    CloseReconnect,\n}\ninterface IReconnectOptions {\n    intervalMs: number;\n    type: ReconnectType;\n}\nexport interface IDomSocketOptions {\n    reConnect?: IReconnectOptions;\n    logCallBack?: (logItem: ILogItem) => void;\n    onMessage?: (message: any) => void;\n    onConnect?: (reason: ConnectReason) => void;\n    onSocketStatus?: (status: DomSocketStatus) => void;\n    minLogLevel?: LogLevel;\n}\nexport enum DomSocketStatus {\n    Initial,\n    Disconnected,\n    WaitingToConnect,\n    Connecting,\n    Connected,\n}\nexport class DomSocket implements ISocket {\n    //https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent#Status_codes\n    private static CodeAndReasons = { userCloded: { code: 4000, reason: \"user closed\" } };\n\n    private ws?: WebSocket;\n    private options: IDomSocketOptions;\n    private url: string;\n    private id: string;\n    private seqErrCount: number;\n    private reconnectTryCount: number;\n    private timerID?: number;\n    private msgSenderList: Array<() => void>;\n\n    private _status: DomSocketStatus;\n    public get status(): DomSocketStatus {\n        return this._status;\n    }\n    public set status(value: DomSocketStatus) {\n        if (value === this._status) { return; }\n        this._status = value;\n        this.options.onSocketStatus?.(this._status);\n    }\n    constructor(url: string, options: IDomSocketOptions = {}) {\n        this._status = DomSocketStatus.Initial;\n        this.msgSenderList = [];\n        this.seqErrCount = 0;\n        this.reconnectTryCount = 0;\n        this.timerID = undefined;\n        this.url = url;\n        this.id = url.length > 40 ? url.substring(0, 40) : url;\n        this.options = options;\n        this.options.minLogLevel = this.options.minLogLevel || LogLevel.log;\n    }\n\n    public destroy(): void {\n        this.Close()\n    }\n\n    public set OnConnect(cb: (reason: ConnectReason) => void) {\n        this.options.onConnect = cb;\n    }\n    public set OnMessage(cb: (message: any) => void) {\n        this.options.onMessage = cb;\n    }\n    public set ReConnect(option: IReconnectOptions) {\n        this.options.reConnect = option;\n    }\n    public set MinLogLevel(minLogLevel: LogLevel) {\n        this.options.minLogLevel = minLogLevel;\n    }\n    public get Status(): DomSocketStatus {\n        return this.status;\n    }\n    public set onSocketStatus(cb: (status: DomSocketStatus) => void) {\n        this.options.onSocketStatus = cb;\n    }\n\n\n    public async Send(message: object | string): Promise<boolean | string> {\n        const data: string = message instanceof Object ? JSON.stringify(message) : message;\n        return new Promise<boolean | string>((res, rej) => {\n            const msgSender = () => {\n                this.log({ message: \"Sending msg: \" + data, level: LogLevel.debug });\n                this.ws!.send(data);\n                res(true);\n            };\n            const reason = this.reConnect(ConnectReason.SendReconnect, msgSender);\n            if (reason) {\n                res(reason);\n            }\n        });\n    }\n    /**\n     * \n     * @param code 4200-4300. -> https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent#Status_codes\n     * @param reason \n     */\n    public Close(code?: number, reason?: string) {\n        const ws = this.ws;\n        this.ws = undefined;\n        if (!ws) { return; }\n        const userCloded = DomSocket.CodeAndReasons.userCloded;\n        code = code ?? userCloded.code;\n        reason = reason ?? userCloded.reason;\n        this.log({ message: `Close call code: ${code} reason: ${reason}`, level: LogLevel.debug });\n        this.options.reConnect = undefined;\n        ws.close(code, reason);\n    }\n    public Connect() {\n        this.reConnect(ConnectReason.ConnectCall);\n        return this;\n    }\n\n\n    private log(options: { message: string, level: LogLevel, additional?: any }) {\n        if (this.options.minLogLevel && LogLevelLookup[options.level] < LogLevelLookup[this.options.minLogLevel]) { return; }\n        const message = `Client ${this.id}: ${options.message}`;\n        this.options.logCallBack?.({ message, additional: options.additional, level: options.level, timeFormat: \"time\" });\n    }\n\n    private reConnect(reason: ConnectReason, msgSender?: () => void) {\n        switch (this.ws?.readyState) {\n            case WebSocket.OPEN:\n                msgSender?.(); return; // if open, send and return\n            case WebSocket.CONNECTING:\n                msgSender && this.msgSenderList.push(msgSender); return; // if connecting, queue and return\n            case WebSocket.CLOSED:\n            case WebSocket.CLOSING:\n            default: // ws -> null\n                break;\n        }\n        if (reason == ConnectReason.ConnectCall) {\n            msgSender && this.msgSenderList.push(msgSender); // queue and try connection\n            this.connect(reason);\n            return;\n        }\n        if (!this.options.reConnect) { return \"Closed\"; } // no reconnect, fail and return\n\n        msgSender && this.msgSenderList.push(msgSender); // queue and try re-connection\n        if (this.timerID) { return; } // it is allready timered\n\n        this.status = DomSocketStatus.WaitingToConnect;\n        this.reconnectTryCount++;\n        const timeoutCounter = this.calculateReconnectInterval(this.options.reConnect);\n        this.timerID = window.setTimeout(() => {\n            this.timerID = undefined;\n            this.connect(reason);\n        }, timeoutCounter);\n    }\n    private connect(reason: ConnectReason) {\n        this.status = DomSocketStatus.Connecting;\n        this.ws = new WebSocket(this.url);\n        this.ws.onclose = this.onSocketClose.bind(this);\n        this.ws.onopen = (openEvent: Event) => this.onSocketOpen(openEvent, reason);\n        this.ws.onerror = this.onSocketError.bind(this);\n        this.ws.onmessage = this.onSocketMessage.bind(this);\n    }\n\n    private onSocketError(errorEvent: Event) {\n        let reconMsg = \"\";\n        if ((!this.ws || this.ws.readyState == WebSocket.CLOSED) && this.options.reConnect) {\n            this.seqErrCount++;\n            reconMsg = this.options.reConnect ? \", errCount: \" + this.seqErrCount : \"\";\n            this.reConnect(ConnectReason.ErrorReconnect);\n        }\n        this.log({ message: \"error\" + reconMsg, level: LogLevel.error, additional: errorEvent });\n    }\n\n    private calculateReconnectInterval(options: IReconnectOptions) {\n        let calculatedInterval = options.intervalMs;\n\n        if (options.type == ReconnectType.BackOff) {\n            const fibonacciArray = [1, 2, 3, 5, 8, 13, 21, 34, 55];\n            let intervalUnit = options.intervalMs / 5\n            let fibonacciRatio = this.reconnectTryCount > fibonacciArray.length ? fibonacciArray[fibonacciArray.length - 1] : fibonacciArray[this.reconnectTryCount - 1]\n            calculatedInterval = Math.round(intervalUnit * fibonacciRatio);\n        }\n        return calculatedInterval;\n    }\n\n\n\n    private onSocketOpen(openEvent: Event, reason: ConnectReason) {\n        this.status = DomSocketStatus.Connected;\n        this.log({ message: \"connected\", level: LogLevel.log });\n        this.options.onConnect?.(reason);\n        this.seqErrCount = 0;\n        this.reconnectTryCount = 0;\n        while (this.msgSenderList.length) {\n            this.msgSenderList.pop()?.();\n        }\n    }\n    private onSocketClose(closeEvent: CloseEvent) {\n        this.status = DomSocketStatus.Disconnected;\n        this.log({ message: \"error\", level: LogLevel.log });\n        const userCloded = DomSocket.CodeAndReasons.userCloded;\n        if (closeEvent.code == userCloded.code && closeEvent.reason == userCloded.reason) {\n            return;\n        }\n        if (!this.options.reConnect) {\n            return;\n        }\n        this.reConnect(ConnectReason.CloseReconnect);\n    }\n    private onSocketMessage(messageEvent: MessageEvent) {\n        this.log({ message: \"message\", level: LogLevel.debug });\n        this.options.onMessage?.(messageEvent.data);\n    }\n\n\n\n}"]}