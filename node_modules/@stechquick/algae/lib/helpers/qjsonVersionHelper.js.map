{"version":3,"file":"qjsonVersionHelper.js","sourceRoot":"","sources":["../../src/helpers/qjsonVersionHelper.ts"],"names":[],"mappings":"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","sourcesContent":["import * as fs from \"fs\";\nimport path from \"path\";\n// import { IBundleContainer } from \"../quick/quickSettingsBundler\";\nconst excludedDirectoryDict: Record<string, boolean> = {\n    images: true,\n    css: true,\n    font: true\n}\nexport class QjsonVersionHelper {\n    public static mapDirectorytoSettingsYaml(settings: Record<string, any>, yamlObj:  Record<string, any>) {\n        let projectRoot = process.cwd();\n        let directoryFileName = \"static\";\n        let directoryFilePath = path.join(projectRoot, directoryFileName);\n        let cacheObject = this.mapDirectory(directoryFilePath);\n        let mappedObject = this.mapRootDirectory(cacheObject, directoryFileName);\n        settings.hasOwnProperty(\"versions\") ? settings.versions.pageVersions = mappedObject : settings.versions = { pageVersions: mappedObject };\n        let yamlString = yamlObj.safeDump(settings);\n        fs.writeFileSync(path.join(projectRoot, \"dist/client/settings/settings.yaml\" ), yamlString);\n        fs.writeFileSync(path.join(projectRoot, \"dist/server/settings/settings.yaml\" ), yamlString);\n    }\n\n    private static mapDirectory(directory: any) {\n        let settingsYamlObJ: Record<string, any> = {};\n        let files = fs.readdirSync(directory);\n        files.forEach(file => {\n            let filePath = path.join(directory, file);\n            let fileStats = fs.statSync(filePath);\n            if (fileStats.isDirectory() && !excludedDirectoryDict[file]) {\n                settingsYamlObJ[file] = this.mapDirectory(filePath);\n            }\n            if ((path.extname(file) === \".qjson\") || (path.extname(file) === \".js\") || (path.extname(file) === \".ts\")) {\n                file = (path.extname(file) === \".ts\") ? file.replace('.ts', '.js') : file;\n                settingsYamlObJ[file] = fileStats.mtime.toISOString().replace(\"Z\", fileStats.mtime.getTimezoneOffset().toString());\n            }\n        });\n        return settingsYamlObJ;\n    }\n\n    private static mapRootDirectory(directoryObject: Record<string, any>, directoryName: string) {\n        const rootObject: Record<string, any> = {};\n        rootObject[directoryName] = directoryObject;\n        return rootObject;\n    }\n}"]}