"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.QJsonParser = void 0;
var QJsonParser = /** @class */ (function () {
    function QJsonParser() {
    }
    QJsonParser.prototype.qJsonMediumDecider = function (qjsonData) {
        if (typeof qjsonData == "string") {
            return qjsonData.startsWith('{"qjson":"') ? JSON.parse(qjsonData).qjson : qjsonData;
        }
        else {
            var qjsonString = JSON.stringify(qjsonData);
            return qjsonData.qjson || qjsonString;
        }
    };
    QJsonParser.prototype.parseQJsonContent = function (jsonString) {
        var json = jsonString;
        if (jsonString.indexOf("let pjson =") > -1) {
            var jsonSplitted = jsonString.split("let pjson =");
            jsonSplitted = jsonSplitted[1].split(';\nexport')[0].split(';\r\nexport');
            json = jsonSplitted[0];
        }
        else if (json.indexOf("rally_microUI") > -1) {
            var registerIndex = json.indexOf("registerQJson");
            var jsonStartIndex = json.indexOf(",", registerIndex) + 1;
            json = json.substring(jsonStartIndex, json.length - 2);
        }
        return JSON.parse(json);
    };
    QJsonParser.prototype.deleteSourceMapping = function (jsonString) {
        var searchValue = '//# sourceMappingURL=data:application/json;base64';
        var regex = new RegExp("(" + searchValue + "+)", 'gi');
        var regexCount = jsonString.match(regex);
        regexCount === null || regexCount === void 0 ? void 0 : regexCount.forEach(function () {
            var indexStart = jsonString.indexOf(searchValue);
            var indexEnd = jsonString.substring(indexStart).indexOf('"');
            jsonString = jsonString.substring(0, indexStart) + jsonString.substring(indexStart + indexEnd);
        });
        return jsonString;
    };
    QJsonParser.prototype.minifyQjson = function (jsonBody, keepSourceMappingURL) {
        var jsonString = this.qJsonMediumDecider(jsonBody);
        if (!keepSourceMappingURL) {
            jsonString = this.deleteSourceMapping(jsonString);
        }
        var qjson = this.parseQJsonContent(jsonString);
        qjson === null || qjson === void 0 ? true : delete qjson.pJson;
        qjson === null || qjson === void 0 ? true : delete qjson.lrids;
        return "let pjson = " + JSON.stringify(qjson) + ";\nexport default pjson";
    };
    return QJsonParser;
}());
exports.QJsonParser = QJsonParser;
//# sourceMappingURL=qJsonParser.js.map