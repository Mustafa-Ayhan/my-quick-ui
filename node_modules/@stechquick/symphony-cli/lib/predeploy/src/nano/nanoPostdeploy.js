"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.NanoPostDeploy = void 0;
const tslib_1 = require("tslib");
const fs = tslib_1.__importStar(require("fs"));
const path = tslib_1.__importStar(require("path"));
const log_1 = require("@stechquick/symphony-common/lib/log");
const chalk_1 = require("../../../helpers/chalk");
const fileHelper_1 = require("@stechquick/symphony-common/lib/helpers/fileHelper");
class NanoPostDeploy {
    static execute() {
        log_1.Logger.log({ message: chalk_1.Chalk.create("green.bold", "Postdeploy starting..."), timeFormat: "datetime" });
        const deleteTargetItems = new Array();
        this.deleteList.forEach(deleteItem => {
            log_1.Logger.log({ message: "Delete item: " + deleteItem });
            const parsedDeleteItem = path.parse(deleteItem);
            const targetItem = './' + parsedDeleteItem.name + parsedDeleteItem.ext;
            deleteTargetItems.push(targetItem);
        });
        this.deleteTargets(deleteTargetItems);
        log_1.Logger.log({ message: chalk_1.Chalk.create("green.bold", "Postdeploy finished successfully..."), timeFormat: "datetime" });
    }
    //pre deploy commona al fn dekininde al!!
    static deleteTargets(items) {
        items.forEach(delTarget => {
            if (!fs.existsSync(delTarget)) {
                return;
            }
            log_1.Logger.log({ message: "Deleting Item:" + delTarget });
            if (fileHelper_1.FileHelper.isDirectory(delTarget)) {
                fileHelper_1.FileHelper.removeFolder(delTarget);
                fs.rmdirSync(delTarget);
            }
            else {
                fs.unlinkSync(delTarget);
            }
        });
    }
}
exports.NanoPostDeploy = NanoPostDeploy;
NanoPostDeploy.deleteList = [".npmrc", "Dockerfile"];
