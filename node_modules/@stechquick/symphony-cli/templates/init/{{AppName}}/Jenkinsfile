@Library("tools@isleasing_dev_remote_fn_parameters")_

jenkinsfileSymphony{
    notifyPushBuildStatus = true
    stage('Environment Setup'){
        ansiColor('xterm') {
            sh '''rm -f package-lock.json
                  npm install node@13.7.0'''
        }
    }
    stage('Resolve Dependencies'){
        ansiColor('xterm') {
            sh '''npm install'''
        }
    }
    stage('Build {{AppName}} SYM-App'){
        ansiColor('xterm') {
            sh '''npm run build -- --skipversion'''
        }
    }
    stage('Docker Login'){
        ansiColor('xterm') {
            withCredentials([string(credentialsId: 'SYMPHONYDEMO_DOCKER_PASSWORD', variable: 'DOCKER_PASSWORD')]) {
                sh "docker login --username=symphonydemo --password=${DOCKER_PASSWORD}"
            }
        }
    }
    stage('Deploy {{AppName}} SYM-App'){
        ansiColor('xterm') {
            withCredentials([string(credentialsId: 'SYMPHONYDEMO_DOCKER_PASSWORD', variable: 'DOCKER_PASSWORD')]) {
                sh "npm run deploy -- --d_url='https://registry.hub.docker.com' --d_user='symphonydemo' --d_pass=${DOCKER_PASSWORD} --f_url='http://serverless.fn-api.plateau.softtech' --node_env='default'"
            }
            archiveArtifacts allowEmptyArchive: true, artifacts: 'package-lock.json'
        }
    }
}