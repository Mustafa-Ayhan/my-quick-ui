"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.IsMultiPart = exports.CommonContentTypes = exports.Proxy = void 0;
var http_1 = __importDefault(require("http"));
var https_1 = __importDefault(require("https"));
var urlHelper_1 = require("./urlHelper");
function Proxy(serverResponse, targetUrl, _a) {
    var method = _a.method, headers = _a.headers, body = _a.body;
    var protocol = urlHelper_1.UrlHelper.GetUrlProtocol(targetUrl) == "https" ? https_1.default : http_1.default;
    var proxyReq = protocol.request(targetUrl, { method: method, headers: headers }, function (res) {
        var _a;
        serverResponse.writeHead((_a = res.statusCode) !== null && _a !== void 0 ? _a : 500, res.headers);
        res.on("data", function (chunk) {
            if (res.headers["content-encoding"]) {
                serverResponse.write(chunk, "binary");
            }
            else {
                serverResponse.write(chunk);
            }
        });
        res.on("end", function () {
            serverResponse.end();
        });
    });
    proxyReq.on("error", function (err) {
        console.error(targetUrl + " returned err", err);
        serverResponse.writeHead(502);
        serverResponse.end("selamlar olmadÄ±", "utf-8");
    });
    if (body) {
        var req = body;
        switch (typeof (body)) {
            case "object":
                if (body instanceof Buffer) {
                    req = body;
                }
                else {
                    req = JSON.stringify(body);
                }
                break;
        }
        proxyReq.write(req);
    }
    proxyReq.end();
}
exports.Proxy = Proxy;
var CommonContentTypes;
(function (CommonContentTypes) {
    CommonContentTypes["multipart/form-data"] = "multipart/form-data";
    CommonContentTypes["text/html"] = "text/html";
    CommonContentTypes["application/json"] = "application/json";
})(CommonContentTypes = exports.CommonContentTypes || (exports.CommonContentTypes = {}));
;
function IsMultiPart(contentType) {
    var multipartIndex = contentType === null || contentType === void 0 ? void 0 : contentType.indexOf(CommonContentTypes["multipart/form-data"]);
    if (multipartIndex === undefined) {
        return false;
    } // must be ===
    return multipartIndex > -1;
}
exports.IsMultiPart = IsMultiPart;
//# sourceMappingURL=httpHelper.js.map