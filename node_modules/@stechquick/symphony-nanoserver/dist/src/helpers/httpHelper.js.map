{"version":3,"file":"httpHelper.js","sourceRoot":"","sources":["../../../src/helpers/httpHelper.ts"],"names":[],"mappings":";;;;;;AAAA,8CAAwB;AACxB,gDAA0B;AAC1B,yCAAwC;AACxC,SAAgB,KAAK,CAAC,cAAmC,EAAE,SAAiB,EAAE,EAA6F;QAA3F,MAAM,YAAA,EAAE,OAAO,aAAA,EAAE,IAAI,UAAA;IACjG,IAAM,QAAQ,GAAG,qBAAS,CAAC,cAAc,CAAC,SAAS,CAAC,IAAI,OAAO,CAAC,CAAC,CAAC,eAAK,CAAC,CAAC,CAAC,cAAI,CAAC;IAC/E,IAAM,QAAQ,GAAG,QAAQ,CAAC,OAAO,CAAC,SAAS,EAAE,EAAE,MAAM,QAAA,EAAE,OAAO,SAAA,EAAE,EAAE,UAAU,GAAG;;QAC3E,cAAc,CAAC,SAAS,OAAC,GAAG,CAAC,UAAU,mCAAI,GAAG,EAAE,GAAG,CAAC,OAAO,CAAC,CAAC;QAC7D,GAAG,CAAC,EAAE,CAAC,MAAM,EAAE,UAAC,KAAK;YACjB,IAAI,GAAG,CAAC,OAAO,CAAC,kBAAkB,CAAC,EAAE;gBACjC,cAAc,CAAC,KAAK,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;aACzC;iBAAM;gBACH,cAAc,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;aAC/B;QACL,CAAC,CAAC,CAAC;QACH,GAAG,CAAC,EAAE,CAAC,KAAK,EAAE;YACV,cAAc,CAAC,GAAG,EAAE,CAAC;QACzB,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,EAAE,CAAC,OAAO,EAAE,UAAC,GAAG;QAErB,OAAO,CAAC,KAAK,CAAI,SAAS,kBAAe,EAAE,GAAG,CAAC,CAAC;QAChD,cAAc,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;QAC9B,cAAc,CAAC,GAAG,CAAC,iBAAiB,EAAE,OAAO,CAAC,CAAC;IACnD,CAAC,CAAC,CAAC;IAEH,IAAI,IAAI,EAAE;QACN,IAAI,GAAG,GAAQ,IAAI,CAAC;QACpB,QAAQ,OAAO,CAAC,IAAI,CAAC,EAAE;YACnB,KAAK,QAAQ;gBACT,IAAI,IAAI,YAAY,MAAM,EAAC;oBACvB,GAAG,GAAG,IAAI,CAAC;iBACd;qBAAI;oBACD,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;iBAC9B;gBACD,MAAM;SACb;QACD,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;KACvB;IACD,QAAQ,CAAC,GAAG,EAAE,CAAC;AACnB,CAAC;AArCD,sBAqCC;AAED,IAAY,kBAIX;AAJD,WAAY,kBAAkB;IAC1B,iEAA6C,CAAA;IAC7C,6CAAyB,CAAA;IACzB,2DAAuC,CAAA;AAC3C,CAAC,EAJW,kBAAkB,GAAlB,0BAAkB,KAAlB,0BAAkB,QAI7B;AAAA,CAAC;AAEF,SAAgB,WAAW,CAAC,WAAoB;IAC5C,IAAM,cAAc,GAAG,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,OAAO,CAAC,kBAAkB,CAAC,qBAAqB,CAAC,CAAC,CAAC;IACvF,IAAI,cAAc,KAAK,SAAS,EAAC;QAAC,OAAO,KAAK,CAAC;KAAC,CAAC,cAAc;IAC/D,OAAO,cAAc,GAAG,CAAC,CAAC,CAAC;AAC/B,CAAC;AAJD,kCAIC","sourcesContent":["import http from \"http\";\nimport https from \"https\";\nimport { UrlHelper } from \"./urlHelper\";\nexport function Proxy(serverResponse: http.ServerResponse, targetUrl: string, { method, headers, body }: { method?: string, headers: http.IncomingHttpHeaders, body?: any }) {\n    const protocol = UrlHelper.GetUrlProtocol(targetUrl) == \"https\" ? https : http;\n    const proxyReq = protocol.request(targetUrl, { method, headers }, function (res) {\n        serverResponse.writeHead(res.statusCode ?? 500, res.headers);\n        res.on(\"data\", (chunk) => {\n            if (res.headers[\"content-encoding\"]) {\n                serverResponse.write(chunk, \"binary\");\n            } else {\n                serverResponse.write(chunk);\n            }\n        });\n        res.on(\"end\", () => {\n            serverResponse.end();\n        });\n    });\n\n    proxyReq.on(\"error\", (err) => {\n\n        console.error(`${targetUrl} returned err`, err);\n        serverResponse.writeHead(502);\n        serverResponse.end(\"selamlar olmadÄ±\", \"utf-8\");\n    });\n\n    if (body) {\n        let req: any = body;\n        switch (typeof (body)) {\n            case \"object\":\n                if (body instanceof Buffer){\n                    req = body;\n                }else{\n                    req = JSON.stringify(body);\n                }\n                break;\n        }\n        proxyReq.write(req);\n    }\n    proxyReq.end();\n}\n\nexport enum CommonContentTypes {\n    \"multipart/form-data\" = \"multipart/form-data\",\n    \"text/html\" = \"text/html\",\n    \"application/json\" = \"application/json\"\n};\n\nexport function IsMultiPart(contentType?: string): boolean{\n    const multipartIndex = contentType?.indexOf(CommonContentTypes[\"multipart/form-data\"]);\n    if (multipartIndex === undefined){return false;} // must be ===\n    return multipartIndex > -1;\n}"]}