{"version":3,"file":"fileHandler.js","sourceRoot":"","sources":["../../src/fileHandler.ts"],"names":[],"mappings":";;;;;;AAAA,8CAAwB;AACxB,0CAAoB;AASpB;IAAA;IA8CA,CAAC;IA7CU,uCAAiB,GAAxB,UAAyB,QAAgB,EAAE,SAAsB;QAC7D,IAAM,QAAQ,GAAG,cAAI,CAAC,OAAO,CAAC,cAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,SAAS,CAAC,GAAG,EAAE,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;QAClF,IAAM,eAAe,GAAG,eAAa,QAAQ,aAAQ,SAAS,CAAC,GAAG,kBAAa,SAAS,CAAC,IAAI,MAAG,CAAC;QACjG,IAAI,CAAC,YAAE,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE;YAC1B,IAAM,GAAG,GAAG,gBAAgB,CAAC;YAC7B,OAAO,CAAC,KAAK,CAAI,GAAG,UAAK,QAAU,EAAE,eAAe,CAAC,CAAC;YACtD,OAAO,EAAE,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,GAAG,EAAE,CAAC;SACxC;QACD,IAAM,WAAW,GAAG,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;QAEvD,IAAI;YACA,IAAM,IAAI,GAAG,YAAE,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC;YACvC,OAAO,EAAE,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,EAAE,cAAc,EAAE,WAAW,EAAE,gBAAgB,EAAE,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;SAC7H;QAAC,OAAO,EAAE,EAAE;YACT,OAAO,CAAC,KAAK,CAAC,sBAAoB,QAAU,EAAE,EAAE,EAAE,eAAe,CAAC,CAAA;YAClE,OAAO,EAAE,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,sBAAsB,GAAG,EAAE,CAAC,IAAI,EAAE,CAAC;SACrE;IACL,CAAC;IAGO,oCAAc,GAAtB,UAAuB,SAAiB;QACpC,IAAM,SAAS,GAAG,YAAY,CAAC;QAC/B,IAAM,SAAS,GAAuC;YAClD,OAAO,EAAE,WAAW;YACpB,KAAK,EAAE,uCAAuC;YAC9C,MAAM,EAAE,UAAU;YAClB,OAAO,EAAE,kBAAkB;YAC3B,MAAM,EAAE,WAAW;YACnB,MAAM,EAAE,WAAW;YACnB,MAAM,EAAE,WAAW;YACnB,OAAO,EAAE,YAAY;YACrB,MAAM,EAAE,WAAW;YACnB,MAAM,EAAE,WAAW;YACnB,OAAO,EAAE,uBAAuB;YAChC,MAAM,EAAE,sBAAsB;YAC9B,MAAM,EAAE,+BAA+B;YACvC,MAAM,EAAE,sBAAsB;YAC9B,MAAM,EAAE,eAAe;YACvB,MAAM,EAAE,0BAA0B;YAClC,MAAM,EAAE,SAAS;SACpB,CAAC;QAEF,IAAM,WAAW,GAAG,SAAS,CAAC,SAAS,CAAC,IAAI,SAAS,CAAC;QACtD,OAAO,WAAW,CAAC;IACvB,CAAC;IACL,kBAAC;AAAD,CAAC,AA9CD,IA8CC;AA9CY,kCAAW","sourcesContent":["import path from \"path\";\nimport fs from \"fs\";\nimport { IParsedPath } from \"./RouteParser\";\nimport { INanoServerOptionsInternal } from \"./NanoServer\";\n\nexport interface IFileHandleResponse {\n    status: number;\n    headers?: Record<string, string | Array<string>>;\n    content: any\n}\nexport class FileHandler {\n    public handleFileRequest(basePath: string, parsedUrl: IParsedPath): IFileHandleResponse {\n        const filePath = path.resolve(path.join(basePath, parsedUrl.dir, parsedUrl.base));\n        const fileDetailError = `basePath: ${basePath} dir:${parsedUrl.dir} fileName:${parsedUrl.base} `;\n        if (!fs.existsSync(filePath)) {\n            const fnf = \"File Not Found\";\n            console.error(`${fnf}: ${filePath}`, fileDetailError);\n            return { status: 404, content: fnf };\n        }\n        const contentType = this.getContentType(parsedUrl.ext);\n\n        try {\n            const file = fs.readFileSync(filePath);\n            return { status: 200, headers: { \"Content-Type\": contentType, \"Content-Length\": file.length.toString() }, content: file };\n        } catch (ex) {\n            console.error(`File read error: ${filePath}`, ex, fileDetailError)\n            return { status: 500, content: \"Sorry, check error: \" + ex.code };\n        }\n    }\n\n\n    private getContentType(extension: string) {\n        const textPlain = \"text/plain\";\n        const mimeTypes: Record<string, string | undefined> = {\n            '.html': 'text/html',\n            '.js': 'application/javascript; charset=UTF-8',\n            '.css': 'text/css',\n            '.json': 'application/json',\n            '.png': 'image/png',\n            '.jpg': 'image/jpg',\n            '.gif': 'image/gif',\n            '.tiff': 'image/tiff',\n            '.wav': 'audio/wav',\n            '.mp4': 'video/mp4',\n            '.woff': 'application/font-woff',\n            '.ttf': 'application/font-ttf',\n            '.eot': 'application/vnd.ms-fontobject',\n            '.otf': 'application/font-otf',\n            '.svg': 'image/svg+xml',\n            \".dll\": \"application/octet-stream\",\n            \".txt\": textPlain\n        };\n\n        const contentType = mimeTypes[extension] || textPlain;\n        return contentType;\n    }\n}"]}