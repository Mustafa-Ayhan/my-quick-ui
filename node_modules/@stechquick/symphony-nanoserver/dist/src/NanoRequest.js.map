{"version":3,"file":"NanoRequest.js","sourceRoot":"","sources":["../../src/NanoRequest.ts"],"names":[],"mappings":"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","sourcesContent":["import http from \"http\";\nimport url from \"url\";\nimport querystring from \"querystring\";\nimport { CommonContentTypes, IsMultiPart } from \"./helpers/httpHelper\";\n\nexport class NanoRequest {\n    public httpRequest: http.IncomingMessage;\n    public routeDict: Record<string, string>;\n    public matchLeftover?: string;\n    public queryStringDict: Record<string, string | Array<string>>;\n    public args?: string;\n\n\n    constructor(httpRequest: http.IncomingMessage, routeDict: Record<string, string>) {\n        this.httpRequest = httpRequest;\n        this.routeDict = routeDict;\n        this.queryStringDict = this.GetQueryString();\n    }\n\n    public GetBody() {\n        const multiPart = IsMultiPart(this.httpRequest.headers[\"content-type\"]);\n        return new Promise<any>((res, rej) => {\n            let onData: (chunk: any) => void;\n            const free = () => { this.httpRequest.removeListener(\"data\", onData); }\n            const resW: typeof res = value => { free(); res(value); }\n            const rejW: typeof rej = reason => { free(); rej(reason); }\n\n            const chunkBuffer: Array<Buffer> = [];\n            this.httpRequest.on(\"data\", onData = chunk => {\n                chunkBuffer.push(chunk);\n            });\n            this.httpRequest.once(\"close\", () => rejW(new Error(\"socket closed prematurely\"))); // if end resolved, this doesn't reject promise\n            this.httpRequest.once(\"error\", (err) => rejW(err));\n            this.httpRequest.once(\"end\", () => {\n                const finalChunk = Buffer.concat(chunkBuffer);\n                if (multiPart) {\n                    resW(finalChunk);\n                    return;\n                }\n                let json = finalChunk.toString();\n                try {\n                    json = JSON.parse(json);\n                } catch { }\n                resW(json);\n            });\n        })\n    }\n\n    public getBodyRaw() {\n        return new Promise<Buffer>((res, rej) => {\n            let onData: (chunk: any) => void;\n            const free = () => { this.httpRequest.removeListener(\"data\", onData); }\n            const resW: typeof res = value => { free(); res(value); }\n            const rejW: typeof rej = reason => { free(); rej(reason); }\n\n            const chunkBuffer: Array<Buffer> = [];\n            this.httpRequest.on(\"data\", onData = chunk => chunkBuffer.push(chunk));\n            this.httpRequest.once(\"close\", () => rejW(new Error(\"socket closed prematurely\"))); // if end resolved, this doesn't reject promise\n            this.httpRequest.once(\"error\", (err) => rejW(err));\n            this.httpRequest.once(\"end\", () => {\n                const finalChunk = Buffer.concat(chunkBuffer);\n                resW(finalChunk);\n            });\n        })\n    }\n\n\n    // public GetQueryStringValue(key: string): string | undefined | null {\n    //     if (!this.httpRequest || !this.httpRequest.url) {\n    //         return undefined;\n    //     }\n\n    //     key = key.replace(/[\\[\\]]/g, '\\\\$&');\n    //     const regex = new RegExp('[?&]' + key + '(=([^&#]*)|&|#|$)');\n    //     const results = regex.exec(this.httpRequest?.url!);\n    //     if (!results) {\n    //         return undefined;\n    //     }\n    //     if (!results[2]) {\n    //         return null;\n    //     }\n    //     return decodeURIComponent(results[2].replace(/\\+/g, ' '));\n    // }\n\n    public get Headers() {\n        const retVal: Record<string, Array<string> | undefined> = {};\n        Object.keys(this.httpRequest.headers).forEach(headerKey => {\n            const header = this.httpRequest.headers[headerKey];\n            if (!header) {\n                return;\n            }\n            retVal[headerKey] = header instanceof Array ? header : [header];\n        });\n        return retVal;\n    }\n    public get HeadersSingle() {\n        const retVal: Record<string, string | undefined> = {};\n        Object.keys(this.httpRequest.headers).forEach(headerKey => {\n            const header = this.httpRequest.headers[headerKey];\n            if (!header) {\n                return;\n            }\n            retVal[headerKey] = header instanceof Array ? header[0] : header;\n        });\n        return retVal;\n    }\n\n    // public get QueryStringParams() {\n    //     const retVal: Record<string, string | undefined> = {};\n    //     const qString = this.httpRequest.url?.split(\"?\")[1];\n\n    //     if (qString) {\n    //         const values = qString.split(\"&\");\n    //         values.forEach(value => {\n    //             const val = value.split(\"=\");\n    //             retVal[val[0]] = val[1];\n    //         });\n    //     }\n\n    //     return retVal;\n    // }\n\n\n    private GetQueryString(): Record<string, string | Array<string>> {\n        const urlData = url.parse(this.httpRequest.url!);\n        if (!urlData.query) {\n            return {};\n        }\n        const querystringData = querystring.parse(urlData.query);\n        return querystringData;\n    }\n};"]}